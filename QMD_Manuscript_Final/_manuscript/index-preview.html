<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.7.32">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


    <title>Examining Claims of Racial Bias in Predictive Policing through a Geographic Perspective</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      html { -webkit-text-size-adjust: 100%; }
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8a894fcc3cb5e37eb5bf30def131be2f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
     <script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>   <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script> 
      <meta name="citation_title" content="Examining Claims of Racial Bias in Predictive Policing through a Geographic Perspective">
<meta name="citation_author" content="Fareeza Ali and Jackson Howes">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Literate programming;,citation_author=Donald E. Knuth;,citation_publication_date=1984-05;,citation_cover_date=1984-05;,citation_year=1984;,citation_fulltext_html_url=https://doi.org/10.1093/comjnl/27.2.97;,citation_issue=2;,citation_doi=10.1093/comjnl/27.2.97;,citation_issn=0010-4620;,citation_volume=27;,citation_journal_title=Comput. J.;,citation_publisher=Oxford University Press, Inc.;">
</head>

  <body class="quarto-notebook quarto-light">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> Article Notebook</h6>

            <a href="./index.qmd" class="btn btn-primary quarto-download-embed" download="index.qmd">Download Source</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Examining Claims of Racial Bias in Predictive Policing through a Geographic Perspective</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Author</div>
          <div class="quarto-title-meta-heading">Affiliation</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Fareeza Ali and Jackson Howes </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Georgetown University
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>



    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#research-questions-and-hypotheses" id="toc-research-questions-and-hypotheses" class="nav-link" data-scroll-target="#research-questions-and-hypotheses">Research Questions and Hypotheses</a></li>
  <li><a href="#data-and-study-design" id="toc-data-and-study-design" class="nav-link" data-scroll-target="#data-and-study-design">Data and Study Design</a>
  <ul class="collapse">
  <li><a href="#setup-and-load-libraries" id="toc-setup-and-load-libraries" class="nav-link" data-scroll-target="#setup-and-load-libraries">Setup and Load Libraries</a></li>
  <li><a href="#spatial-units-and-coordinate-systems" id="toc-spatial-units-and-coordinate-systems" class="nav-link" data-scroll-target="#spatial-units-and-coordinate-systems">Spatial Units and Coordinate Systems</a></li>
  <li><a href="#demographic-data-census-blocks-to-precincts-via-areal-interpolation" id="toc-demographic-data-census-blocks-to-precincts-via-areal-interpolation" class="nav-link" data-scroll-target="#demographic-data-census-blocks-to-precincts-via-areal-interpolation">Demographic Data: Census Blocks to Precincts via Areal Interpolation</a></li>
  <li><a href="#crime-data-violent-felony-complaint-records" id="toc-crime-data-violent-felony-complaint-records" class="nav-link" data-scroll-target="#crime-data-violent-felony-complaint-records">Crime Data: Violent Felony Complaint Records</a></li>
  <li><a href="#prepost-comparison-windows" id="toc-prepost-comparison-windows" class="nav-link" data-scroll-target="#prepost-comparison-windows">Pre/Post Comparison Windows</a></li>
  </ul></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#global-spatial-autocorrelation-morans-i" id="toc-global-spatial-autocorrelation-morans-i" class="nav-link" data-scroll-target="#global-spatial-autocorrelation-morans-i">Global Spatial Autocorrelation: Moran’s I</a></li>
  <li><a href="#local-morans-i-and-lisa-cluster-typology" id="toc-local-morans-i-and-lisa-cluster-typology" class="nav-link" data-scroll-target="#local-morans-i-and-lisa-cluster-typology">Local Moran’s I and LISA Cluster Typology</a></li>
  <li><a href="#monte-carlo-null-model-for-crime-clustering" id="toc-monte-carlo-null-model-for-crime-clustering" class="nav-link" data-scroll-target="#monte-carlo-null-model-for-crime-clustering">Monte Carlo Null Model for Crime Clustering</a></li>
  <li><a href="#geographically-weighted-regression" id="toc-geographically-weighted-regression" class="nav-link" data-scroll-target="#geographically-weighted-regression">Geographically Weighted Regression</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#global-spatial-autocorrelation" id="toc-global-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-spatial-autocorrelation">Global spatial autocorrelation</a></li>
  <li><a href="#local-clustering-and-overlap-of-crime-and-race-hot-spots" id="toc-local-clustering-and-overlap-of-crime-and-race-hot-spots" class="nav-link" data-scroll-target="#local-clustering-and-overlap-of-crime-and-race-hot-spots">Local clustering and overlap of crime and race “hot spots”</a></li>
  <li><a href="#monte-carlo-evidence-of-excess-clustering-beyond-population-distribution" id="toc-monte-carlo-evidence-of-excess-clustering-beyond-population-distribution" class="nav-link" data-scroll-target="#monte-carlo-evidence-of-excess-clustering-beyond-population-distribution">Monte Carlo evidence of “excess” clustering beyond population distribution</a></li>
  <li><a href="#geographically-weighted-regression-1" id="toc-geographically-weighted-regression-1" class="nav-link" data-scroll-target="#geographically-weighted-regression-1">Geographically Weighted Regression</a></li>
  </ul></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

       <section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<p>Predictive policing systems have been repeatedly criticized for reproducing and amplifying racial disparities, yet empirical evaluation is complicated by the fact that “crime data” are not neutral measurements of underlying criminal behavior but administrative records produced through enforcement, reporting, and institutional decision-making. In this manuscript, we assess whether spatial patterns in recorded violent felony incidents changed in ways consistent with the claim that algorithmic policing intensified racially disparate enforcement. We adopt a geographic perspective, using NYPD precincts as the unit of analysis, violent felony complaint records as the outcome, and census-derived racial composition as the principal demographic covariate. Our design compares a pre-period (2010–2012) and a post-period (2013–2019) bracketing the implementation window of Patternizr, a predictive policing system introduced by the NYPD in 2013. We quantify global spatial autocorrelation in both crime rates and Black population share using Moran’s <span class="math inline">\(I\)</span>, identify local clusters using Local Indicators of Spatial Association (LISA), and assess whether observed clustering exceeds what would be expected under a population-proportional null model via Monte Carlo simulation. Finally, we use geographically weighted regression (GWR) to examine whether the relationship between racial composition and recorded crime rates became more spatially heterogeneous over time. We emphasize throughout that any observed differences are associational rather than causal, given concurrent neighborhood change and other confounds; nonetheless, this framework isolates concrete spatial signatures that are directly relevant to claims of algorithmically mediated bias.</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Public and scholarly debates over predictive policing have increasingly centered on a shared concern: that algorithmic systems trained on historically patterned enforcement data may re-entrench and intensify the very disparities they purport to mitigate. In the specific context of New York City, Patternizr has been described as a tool intended to assist in recognizing potentially related crime patterns; however, even systems framed as investigative aids may shape enforcement attention and thereby the geography of recorded crime. When police deploy resources unevenly across space, administrative “crime” data can reflect both underlying incidents and the spatial distribution of policing itself. As a result, testing claims of algorithmic bias requires methodological approaches that can separate (or at minimum, describe) changes in spatial concentration and demographic overlap.</p>
<p>We therefore pose a geographically grounded question: did the spatial structure of recorded violent felony crime become more clustered after the implementation of Patternizr, and did the geography of those clusters align differently with the geography of Black residential concentration? Importantly, our inferential target is not a direct causal estimate of Patternizr’s effect. Instead, we evaluate whether the <em>spatial signatures</em> of recorded crime—global clustering, local hot spots, and hot-spot overlap with racially concentrated precincts—changed in ways that are consistent with common critiques of predictive policing. We explicitly treat demographic change, including gentrification and population redistribution between 2010 and 2020, as a major confound that must be described alongside any policing-related interpretation.</p>
</section>
<section id="research-questions-and-hypotheses" class="level2">
<h2 class="anchored" data-anchor-id="research-questions-and-hypotheses">Research Questions and Hypotheses</h2>
<p>Our analysis is organized around three primary research questions.</p>
<ol type="1">
<li><p><strong>Did the spatial clustering of violent felony <em>crime rates</em> change between the pre-Patternizr and post-Patternizr periods?</strong> If predictive policing concentrated enforcement attention into a narrower set of precincts, we would expect increased spatial autocorrelation in recorded crime rates. This motivates comparison of global Moran’s <span class="math inline">\(I\)</span> for precinct-level crime rates across periods.</p></li>
<li><p><strong>Did the spatial clustering of Black residential concentration change over the same window, and how does it relate to crime clustering?</strong> Racial residential segregation produces strong spatial autocorrelation in demographic composition. If this structure is stable while crime clustering changes, then changes in the <em>relationship</em> between demographic clustering and crime clustering become substantively interpretable.</p></li>
<li><p><strong>Did the overlap between crime hot spots and Black population hot spots change?</strong> We operationalize “hot spot” using LISA High–High clusters. A reduction in overlap may indicate either (i) a weakening association between racial concentration and recorded crime hot spots, or (ii) demographic change in the precincts that previously occupied both categories.</p></li>
</ol>
<p>In addition, we use geographically weighted regression (GWR) as a diagnostic to evaluate whether the local association between percent Black and precinct crime rates became more spatially heterogeneous over time. Substantively, a shift toward stronger spatial non-stationarity is consistent with a more localized policing geography, but this pattern can also arise from localized neighborhood change and other place-specific dynamics.</p>
</section>
<section id="data-and-study-design" class="level2">
<h2 class="anchored" data-anchor-id="data-and-study-design">Data and Study Design</h2>
<section id="setup-and-load-libraries" class="level3">
<h3 class="anchored" data-anchor-id="setup-and-load-libraries">Setup and Load Libraries</h3>
<p>We begin by loading all required R packages for spatial analysis. The <code>tidyverse</code> provides data manipulation tools, <code>sf</code> handles spatial vector data, <code>tidycensus</code> and <code>tigris</code> allow us to pull Census data and geographic boundaries directly from the Census API, <code>spdep</code> provides spatial autocorrelation and neighbor-based statistics, and <code>patchwork</code> enables combining multiple ggplot figures.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [1]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   4.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>To enable caching of data, set `options(tigris_use_cache = TRUE)`
in your R script or .Rprofile.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spData</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tigris_use_cache =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tigris_progress =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
</section>
<section id="spatial-units-and-coordinate-systems" class="level3">
<h3 class="anchored" data-anchor-id="spatial-units-and-coordinate-systems">Spatial Units and Coordinate Systems</h3>
<p>The unit of analysis is each NYPD precinct. We load an official precinct boundary shapefile and project it to an equal-area / planar coordinate system appropriate for spatial operations (EPSG:32118). All spatial overlays and neighborhood constructions (contiguity weights) are conducted in this projected CRS to ensure that area calculations and adjacency relationships are well-defined.</p>
<p>We load the precinct boundary shapefile from a local GeoJSON file and transform it from WGS84 (latitude/longitude) to the New York State Plane coordinate system (EPSG:32118). This projected coordinate system uses meters as units, which is essential for accurate area calculations during the areal interpolation step.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [2]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>precincts <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"../data/nyc_precincts.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>precincts_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(precincts, <span class="dv">32118</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
</section>
<section id="demographic-data-census-blocks-to-precincts-via-areal-interpolation" class="level3">
<h3 class="anchored" data-anchor-id="demographic-data-census-blocks-to-precincts-via-areal-interpolation">Demographic Data: Census Blocks to Precincts via Areal Interpolation</h3>
<p>Because precinct boundaries do not align with census block boundaries, we construct precinct-level demographics using areal interpolation. Specifically, we obtain census block geometries and block-level decennial census counts for 2010 and 2020. For each census year, we intersect census blocks with precinct polygons, compute the proportion of each block’s area contained within each precinct, and allocate block-level counts proportionally to those intersection weights. Summing the allocated counts across intersections yields precinct-level demographic totals.</p>
<p>Formally, let <span class="math inline">\(b\)</span> index census blocks and <span class="math inline">\(p\)</span> index precincts. Define the intersection area <span class="math inline">\(A_{bp} = \text{area}(b \cap p)\)</span> and block area <span class="math inline">\(A_b = \text{area}(b)\)</span>. The areal weight is:</p>
<p><span class="math display">\[
w_{bp} = \frac{A_{bp}}{A_b}
\]</span></p>
<p>For a block-level count <span class="math inline">\(X_b\)</span> (e.g., total population, race counts), the precinct-allocated contribution from block <span class="math inline">\(b\)</span> is:</p>
<p><span class="math display">\[
X_{bp}^{\text{alloc}} = w_{bp} X_b
\]</span></p>
<p>and the precinct-level total is:</p>
<p><span class="math display">\[
X_p = \sum_{b} X_{bp}^{\text{alloc}}
\]</span></p>
<p>We then compute precinct demographic shares (e.g., percent Black) as:</p>
<p><span class="math display">\[
\%Black_p = 100 \times \frac{Black_p}{TotalPop_p}
\]</span></p>
<p>with analogous definitions for percent Hispanic and percent White.</p>
<p>This approach implicitly assumes uniform population density within each block. While imperfect, it is standard practice when translating census counts to non-nested administrative boundaries, and it produces internally consistent precinct-level denominators for per-capita crime rate computation.</p>
<section id="census-data-processing" class="level4">
<h4 class="anchored" data-anchor-id="census-data-processing">2020 Census Data Processing</h4>
<p>We load the 2020 census block geometries from a local shapefile and filter to the five NYC counties (Bronx, Kings, New York, Queens, Richmond). We then use <code>tidycensus</code> to pull race and ethnicity counts from the 2020 Decennial Census P1 (race) and P2 (Hispanic origin) tables. These block-level counts will be spatially interpolated to precinct boundaries.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [3]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>blocks_2020 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"../data/tl_2020_36_tabblock20/tl_2020_36_tabblock20.shp"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>nyc_counties <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"005"</span>, <span class="st">"047"</span>, <span class="st">"061"</span>, <span class="st">"081"</span>, <span class="st">"085"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>blocks_2020_nyc <span class="ot">&lt;-</span> blocks_2020 <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNTYFP20 <span class="sc">%in%</span> nyc_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
<p>We pull 2020 race data (P1 table: total population and race alone categories) and Hispanic origin data (P2 table) from the Census API. The “wide” output format gives us one column per variable, which simplifies the subsequent join and allocation steps.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [4]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>p1_2020 <span class="ot">&lt;-</span> <span class="fu">get_decennial</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"block"</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"P1_001N"</span>, <span class="st">"P1_003N"</span>, <span class="st">"P1_004N"</span>, <span class="st">"P1_005N"</span>, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"P1_006N"</span>, <span class="st">"P1_007N"</span>, <span class="st">"P1_008N"</span>, <span class="st">"P1_009N"</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"NY"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">county =</span> nyc_counties,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"wide"</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Getting data from the 2020 decennial Census</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using the PL 94-171 Redistricting Data Summary File</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Note: 2020 decennial Census data use differential privacy, a technique that
introduces errors into data to preserve respondent confidentiality.
ℹ Small counts should be interpreted with caution.
ℹ See https://www.census.gov/library/fact-sheets/2021/protecting-the-confidentiality-of-the-2020-census-redistricting-data.html for additional guidance.
This message is displayed once per session.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>p2_2020 <span class="ot">&lt;-</span> <span class="fu">get_decennial</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"block"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"P2_001N"</span>, <span class="st">"P2_002N"</span>, <span class="st">"P2_003N"</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"NY"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">county =</span> nyc_counties,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"wide"</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Getting data from the 2020 decennial Census
Using the PL 94-171 Redistricting Data Summary File</code></pre>
</div>
</div></div>
<p>We join the census demographic data to the block geometries, project to the same coordinate system as our precincts, and compute the area of each block. Then we intersect blocks with precincts to create polygon fragments, calculate what proportion of each block’s area falls within each precinct (the areal weight), and allocate population counts proportionally. Finally, we aggregate these allocated counts by precinct to get precinct-level demographic totals.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [5]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>p1_2020 <span class="ot">&lt;-</span> p1_2020 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">GEOID20 =</span> GEOID)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>p2_2020 <span class="ot">&lt;-</span> p2_2020 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">GEOID20 =</span> GEOID)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>blocks_demo_2020 <span class="ot">&lt;-</span> blocks_2020_nyc <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(p1_2020, <span class="at">by =</span> <span class="st">"GEOID20"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(p2_2020, <span class="at">by =</span> <span class="st">"GEOID20"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>blocks_2020_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(blocks_demo_2020, <span class="dv">32118</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>blocks_2020_proj <span class="ot">&lt;-</span> blocks_2020_proj <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block_area =</span> <span class="fu">st_area</span>(geometry))</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>block_precinct_int_2020 <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(blocks_2020_proj, precincts_proj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>block_precinct_int_2020 <span class="ot">&lt;-</span> block_precinct_int_2020 <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">piece_area =</span> <span class="fu">st_area</span>(geometry),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> <span class="fu">as.numeric</span>(piece_area <span class="sc">/</span> block_area)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>demo_vars_2020 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"P1_001N"</span>, <span class="st">"P1_003N"</span>, <span class="st">"P1_004N"</span>, <span class="st">"P1_005N"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"P1_006N"</span>, <span class="st">"P1_007N"</span>, <span class="st">"P1_008N"</span>, <span class="st">"P1_009N"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"P2_001N"</span>, <span class="st">"P2_002N"</span>, <span class="st">"P2_003N"</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> demo_vars_2020) {</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  block_precinct_int_2020[[<span class="fu">paste0</span>(v, <span class="st">"_alloc"</span>)]] <span class="ot">&lt;-</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    block_precinct_int_2020[[v]] <span class="sc">*</span> block_precinct_int_2020<span class="sc">$</span>weight</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>precinct_demographics_2020 <span class="ot">&lt;-</span> block_precinct_int_2020 <span class="sc">%&gt;%</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(precinct) <span class="sc">%&gt;%</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">ends_with</span>(<span class="st">"_alloc"</span>), sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `summarise()`.
ℹ In argument: `across(ends_with("_alloc"), sum, na.rm = TRUE)`.
ℹ In group 1: `precinct = "1"`.
Caused by warning:
! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.
Supply arguments directly to `.fns` through an anonymous function instead.

  # Previously
  across(a:b, mean, na.rm = TRUE)

  # Now
  across(a:b, \(x) mean(x, na.rm = TRUE))</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>precincts_2020 <span class="ot">&lt;-</span> precincts_proj <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(precinct_demographics_2020, <span class="at">by =</span> <span class="st">"precinct"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
</section>
<section id="census-data-processing-1" class="level4">
<h4 class="anchored" data-anchor-id="census-data-processing-1">2010 Census Data Processing</h4>
<p>We repeat the same areal interpolation process for 2010 Census data. We use <code>tigris::blocks()</code> to download 2010 block geometries directly from the Census. The 2010 Decennial Census uses different table names (P003 for race, P004 for Hispanic origin), so we adjust our variable requests accordingly.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [6]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>blocks_2010 <span class="ot">&lt;-</span> <span class="fu">blocks</span>(<span class="at">state =</span> <span class="st">"NY"</span>, <span class="at">county =</span> nyc_counties, <span class="at">year =</span> <span class="dv">2010</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>blocks_2010_nyc <span class="ot">&lt;-</span> blocks_2010 <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNTYFP10 <span class="sc">%in%</span> nyc_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
<p>We pull 2010 race and Hispanic origin data from the Census API using the appropriate 2010 table codes.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [7]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>p1_2010 <span class="ot">&lt;-</span> <span class="fu">get_decennial</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"block"</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"P003001"</span>, <span class="st">"P003002"</span>, <span class="st">"P003003"</span>, <span class="st">"P003004"</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"P003005"</span>, <span class="st">"P003006"</span>, <span class="st">"P003007"</span>, <span class="st">"P003008"</span>),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"NY"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">county =</span> nyc_counties,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2010</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"wide"</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Getting data from the 2010 decennial Census</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using Census Summary File 1</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>p2_2010 <span class="ot">&lt;-</span> <span class="fu">get_decennial</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"block"</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"P004001"</span>, <span class="st">"P004002"</span>, <span class="st">"P004003"</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"NY"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">county =</span> nyc_counties,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2010</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"wide"</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Getting data from the 2010 decennial Census
Using Census Summary File 1</code></pre>
</div>
</div></div>
<p>We perform the same spatial interpolation workflow for 2010: join demographics to block geometries, project, intersect with precincts, compute areal weights, allocate counts proportionally, and aggregate to precinct totals.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [8]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>p1_2010 <span class="ot">&lt;-</span> p1_2010 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">GEOID10 =</span> GEOID)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>p2_2010 <span class="ot">&lt;-</span> p2_2010 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">GEOID10 =</span> GEOID)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>blocks_demo_2010 <span class="ot">&lt;-</span> blocks_2010_nyc <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(p1_2010, <span class="at">by =</span> <span class="st">"GEOID10"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(p2_2010, <span class="at">by =</span> <span class="st">"GEOID10"</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>blocks_2010_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(blocks_demo_2010, <span class="dv">32118</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>blocks_2010_proj <span class="ot">&lt;-</span> blocks_2010_proj <span class="sc">%&gt;%</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block_area =</span> <span class="fu">st_area</span>(geometry))</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>block_precinct_int_2010 <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(blocks_2010_proj, precincts_proj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>block_precinct_int_2010 <span class="ot">&lt;-</span> block_precinct_int_2010 <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">piece_area =</span> <span class="fu">st_area</span>(geometry),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> <span class="fu">as.numeric</span>(piece_area <span class="sc">/</span> block_area)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>demo_vars_2010 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"P003001"</span>, <span class="st">"P003002"</span>, <span class="st">"P003003"</span>, <span class="st">"P003004"</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"P003005"</span>, <span class="st">"P003006"</span>, <span class="st">"P003007"</span>, <span class="st">"P003008"</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"P004001"</span>, <span class="st">"P004002"</span>, <span class="st">"P004003"</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> demo_vars_2010) {</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  block_precinct_int_2010[[<span class="fu">paste0</span>(v, <span class="st">"_alloc"</span>)]] <span class="ot">&lt;-</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    block_precinct_int_2010[[v]] <span class="sc">*</span> block_precinct_int_2010<span class="sc">$</span>weight</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>precinct_demographics_2010 <span class="ot">&lt;-</span> block_precinct_int_2010 <span class="sc">%&gt;%</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(precinct) <span class="sc">%&gt;%</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">ends_with</span>(<span class="st">"_alloc"</span>), sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>precincts_2010 <span class="ot">&lt;-</span> precincts_proj <span class="sc">%&gt;%</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(precinct_demographics_2010, <span class="at">by =</span> <span class="st">"precinct"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
</section>
<section id="standardize-column-names" class="level4">
<h4 class="anchored" data-anchor-id="standardize-column-names">Standardize Column Names</h4>
<p>The 2010 and 2020 Census use different variable naming conventions. We rename all demographic columns to consistent, human-readable names (e.g., <code>black_alloc</code>, <code>white_alloc</code>, <code>hispanic_alloc</code>) so that downstream code can reference the same column names regardless of which census year the data comes from.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [9]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>precincts_2010 <span class="ot">&lt;-</span> precincts_2010 <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop_alloc =</span> P003001_alloc,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">white_alloc =</span> P003002_alloc,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">black_alloc =</span> P003003_alloc,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">aian_alloc =</span> P003004_alloc,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">asian_alloc =</span> P003005_alloc,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">nhpi_alloc =</span> P003006_alloc,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">other_alloc =</span> P003007_alloc,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">two_or_more_alloc =</span> P003008_alloc,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_total_alloc =</span> P004001_alloc,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_alloc =</span> P004002_alloc,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">not_hispanic_alloc =</span> P004003_alloc</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>precincts_2020 <span class="ot">&lt;-</span> precincts_2020 <span class="sc">%&gt;%</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop_alloc =</span> P1_001N_alloc,</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">white_alloc =</span> P1_003N_alloc,</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">black_alloc =</span> P1_004N_alloc,</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">aian_alloc =</span> P1_005N_alloc,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">asian_alloc =</span> P1_006N_alloc,</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">nhpi_alloc =</span> P1_007N_alloc,</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">other_alloc =</span> P1_008N_alloc,</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">two_or_more_alloc =</span> P1_009N_alloc,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_total_alloc =</span> P2_001N_alloc,</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_alloc =</span> P2_002N_alloc,</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">not_hispanic_alloc =</span> P2_003N_alloc</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
</section>
</section>
<section id="crime-data-violent-felony-complaint-records" class="level3">
<h3 class="anchored" data-anchor-id="crime-data-violent-felony-complaint-records">Crime Data: Violent Felony Complaint Records</h3>
<p>We load a cleaned violent felony complaint dataset from the city containing point locations (latitude/longitude) and complaint dates. Complaint points are converted into an <code>sf</code> point object in WGS84 (EPSG:4326) and then filtered to a bounding box corresponding to New York City to remove obvious geocoding errors. Points are subsequently projected into EPSG:32118 for spatial joins and distance-consistent operations. Complaint dates are parsed to extract year, enabling period-based subsetting.</p>
<p>We read the crime data CSV, convert it to a spatial points object using the longitude and latitude columns, filter out any points that fall outside NYC’s bounding box (likely geocoding errors), project to our analysis CRS, and extract the year from each complaint date for temporal filtering.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [10]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>violent_crimes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/violent_felony_cleaned_13.csv"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>violent_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  violent_crimes,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="dv">4326</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>violent_sf <span class="ot">&lt;-</span> violent_sf <span class="sc">%&gt;%</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(geometry),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>] <span class="sc">&gt;</span> <span class="sc">-</span><span class="fl">74.5</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>] <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">73.7</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>] <span class="sc">&gt;</span> <span class="fl">40.45</span>,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>] <span class="sc">&lt;</span> <span class="fl">40.95</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>violent_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(violent_sf, <span class="dv">32118</span>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>violent_proj <span class="ot">&lt;-</span> violent_proj <span class="sc">%&gt;%</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">complaint_date =</span> <span class="fu">as.Date</span>(complaint_date),</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(complaint_date, <span class="st">"%Y"</span>))</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
</section>
<section id="prepost-comparison-windows" class="level3">
<h3 class="anchored" data-anchor-id="prepost-comparison-windows">Pre/Post Comparison Windows</h3>
<p>To reduce transitional ambiguity surrounding the implementation timeline, we define two non-overlapping windows:</p>
<ul>
<li><strong>Before</strong>: 2010–2012</li>
<li><strong>After</strong>: 2013–2019</li>
</ul>
<p>For each period, we spatially join complaint points to precinct polygons, count incidents per precinct, and compute the precinct-level violent felony rate per 1,000 residents:</p>
<p><span class="math display">\[
CrimeRate_p = 1000 \times \frac{Crimes_p}{TotalPop_p}
\]</span></p>
<p>We exclude precinct 22 (Central Park) due to its negligible residential population, which otherwise induces artificially inflated per-capita rates and undermines interpretability.</p>
<p>We split the crime data into pre-Patternizr (2010-2012) and post-Patternizr (2013-2019) periods. For each period, we spatially join crime points to precincts to determine which precinct each crime falls within, then count crimes per precinct and compute per-capita crime rates. We also calculate demographic percentages (percent Black, Hispanic, White) for use in regression analyses.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [11]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter crimes by period</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>crimes_before <span class="ot">&lt;-</span> violent_proj <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2012</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>crimes_after <span class="ot">&lt;-</span> violent_proj <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2013</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2019</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Crimes before (2010-2012):"</span>, <span class="fu">nrow</span>(crimes_before), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Crimes before (2010-2012): 201231 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Crimes after (2013-2019):"</span>, <span class="fu">nrow</span>(crimes_after), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Crimes after (2013-2019): 412321 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count crimes per precinct - BEFORE</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>crime_counts_before <span class="ot">&lt;-</span> crimes_before <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(precincts_proj, <span class="at">join =</span> st_within) <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(precinct) <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_crimes =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>precincts_before <span class="ot">&lt;-</span> precincts_2010 <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(crime_counts_before, <span class="at">by =</span> <span class="st">"precinct"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_crimes =</span> <span class="fu">replace_na</span>(total_crimes, <span class="dv">0</span>),</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">crime_rate =</span> (total_crimes <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_black =</span> (black_alloc <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_hispanic =</span> (hispanic_alloc <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_white =</span> (white_alloc <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Count crimes per precinct - AFTER</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>crime_counts_after <span class="ot">&lt;-</span> crimes_after <span class="sc">%&gt;%</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(precincts_proj, <span class="at">join =</span> st_within) <span class="sc">%&gt;%</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(precinct) <span class="sc">%&gt;%</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_crimes =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>precincts_after <span class="ot">&lt;-</span> precincts_2020 <span class="sc">%&gt;%</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(crime_counts_after, <span class="at">by =</span> <span class="st">"precinct"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_crimes =</span> <span class="fu">replace_na</span>(total_crimes, <span class="dv">0</span>),</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">crime_rate =</span> (total_crimes <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_black =</span> (black_alloc <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_hispanic =</span> (hispanic_alloc <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_white =</span> (white_alloc <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
<p>We remove Central Park (Precinct 22) from both datasets because its near-zero residential population produces undefined or extreme crime rates that would distort our analysis.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [12]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>precincts_before <span class="ot">&lt;-</span> precincts_before <span class="sc">%&gt;%</span> <span class="fu">filter</span>(precinct <span class="sc">!=</span> <span class="st">"22"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>precincts_after <span class="ot">&lt;-</span> precincts_after <span class="sc">%&gt;%</span> <span class="fu">filter</span>(precinct <span class="sc">!=</span> <span class="st">"22"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Precincts remaining (before):"</span>, <span class="fu">nrow</span>(precincts_before), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Precincts remaining (before): 76 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Precincts remaining (after):"</span>, <span class="fu">nrow</span>(precincts_after), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Precincts remaining (after): 76 </code></pre>
</div>
</div></div>
<p>We examine summary statistics for crime rates in both periods to verify our data processing produced reasonable values and to get a sense of the distribution before proceeding to spatial analysis.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [13]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(precincts_before<span class="sc">$</span>crime_rate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  6.386  18.089  24.631  27.589  34.098 115.440 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(precincts_after<span class="sc">$</span>crime_rate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  11.23   30.41   47.22   52.28   67.38  191.28 </code></pre>
</div>
</div></div>
<p><img src="crime_rate_comparison.png" class="img-fluid" alt="Crime rates per 1,000 residents across NYPD precincts before and after Patternizr"> <img src="pct_black_comparison.png" class="img-fluid" alt="Percent of population that is black across NYPD precincts before and after Patternizr"></p>
</section>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<p>Our empirical strategy combines (i) global measures of spatial autocorrelation, (ii) local cluster detection, (iii) a simulation-based null model to benchmark observed clustering, and (iv) a spatially varying regression diagnostic. These components correspond directly to the computational workflow implemented below.</p>
<section id="global-spatial-autocorrelation-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="global-spatial-autocorrelation-morans-i">Global Spatial Autocorrelation: Moran’s I</h3>
<p>We quantify global spatial autocorrelation using Moran’s <span class="math inline">\(I\)</span> for two variables: (a) precinct crime rates and (b) percent Black population. Spatial dependence is defined using a queen contiguity neighborhood structure (shared edges or corners). Let <span class="math inline">\(x_p\)</span> denote a precinct-level variable (e.g., crime rate) and <span class="math inline">\(\bar{x}\)</span> its mean. With spatial weights <span class="math inline">\(w_{pq}\)</span> (row-standardized), Moran’s <span class="math inline">\(I\)</span> is:</p>
<p><span class="math display">\[
I = \frac{n}{S_0}\frac{\sum_{p}\sum_{q} w_{pq}(x_p - \bar{x})(x_q - \bar{x})}{\sum_{p}(x_p - \bar{x})^2}
\]</span></p>
<p>where <span class="math inline">\(n\)</span> is the number of precincts and <span class="math inline">\(S_0 = \sum_{p}\sum_{q} w_{pq}\)</span>. We compute Moran’s <span class="math inline">\(I\)</span> separately for each period and interpret differences as changes in the degree of clustering in the precinct-level surfaces.</p>
<p>We construct spatial weights matrices based on queen contiguity (precincts that share an edge or corner are considered neighbors). The <code>spdep</code> package requires sp objects, so we convert our sf objects and then build neighbor lists and row-standardized weights. Row standardization ensures that the weights for each precinct sum to 1.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [14]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to sp objects for spdep</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>precincts_before_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(precincts_before, <span class="st">"Spatial"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>precincts_after_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(precincts_after, <span class="st">"Spatial"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create queen contiguity neighbors (precincts sharing edges or corners)</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>nb_before <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(precincts_before_sp, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in poly2nb(precincts_before_sp, queen = TRUE): neighbour object has 3 sub-graphs;
if this sub-graph count seems unexpected, try increasing the snap argument.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>nb_after <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(precincts_after_sp, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in poly2nb(precincts_after_sp, queen = TRUE): neighbour object has 3 sub-graphs;
if this sub-graph count seems unexpected, try increasing the snap argument.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to spatial weights (row-standardized)</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>weights_before <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb_before, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>weights_after <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb_after, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
<p>We compute Global Moran’s I for crime rates in both periods. A positive and significant Moran’s I indicates that precincts with similar crime rates tend to be located near each other (positive spatial autocorrelation). We compare the values across periods to assess whether crime became more or less spatially clustered after Patternizr.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [15]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Before period</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>moran_crime_before <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(precincts_before<span class="sc">$</span>crime_rate, weights_before)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_crime_before)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  precincts_before$crime_rate  
weights: weights_before    

Moran I statistic standard deviate = 3.7442, p-value = 9.047e-05
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.269439611      -0.013333333       0.005703561 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># After period</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>moran_crime_after <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(precincts_after<span class="sc">$</span>crime_rate, weights_after)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_crime_after)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  precincts_after$crime_rate  
weights: weights_after    

Moran I statistic standard deviate = 4.3169, p-value = 7.911e-06
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.325313015      -0.013333333       0.006153788 </code></pre>
</div>
</div></div>
<p>We also compute Global Moran’s I for percent Black population to understand the spatial structure of racial composition. High values indicate strong residential segregation at the precinct scale. By comparing this to crime rate clustering, we can assess whether crime clusters align with demographic clusters.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [16]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Before period</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>moran_black_before <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(precincts_before<span class="sc">$</span>pct_black, weights_before)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_black_before)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  precincts_before$pct_black  
weights: weights_before    

Moran I statistic standard deviate = 7.1848, p-value = 3.366e-13
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.570490119      -0.013333333       0.006602919 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># After period</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>moran_black_after <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(precincts_after<span class="sc">$</span>pct_black, weights_after)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_black_after)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  precincts_after$pct_black  
weights: weights_after    

Moran I statistic standard deviate = 7.0478, p-value = 9.092e-13
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.557878445      -0.013333333       0.006568909 </code></pre>
</div>
</div></div>
<p>We compile the Moran’s I results into a summary table for easy comparison across variables and time periods.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [17]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>moran_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">c</span>(<span class="st">"Crime Rate"</span>, <span class="st">"Crime Rate"</span>, <span class="st">"Pct Black"</span>, <span class="st">"Pct Black"</span>),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Period =</span> <span class="fu">c</span>(<span class="st">"Before"</span>, <span class="st">"After"</span>, <span class="st">"Before"</span>, <span class="st">"After"</span>),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Morans_I =</span> <span class="fu">c</span>(</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    moran_crime_before<span class="sc">$</span>estimate[<span class="st">"Moran I statistic"</span>],</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    moran_crime_after<span class="sc">$</span>estimate[<span class="st">"Moran I statistic"</span>],</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    moran_black_before<span class="sc">$</span>estimate[<span class="st">"Moran I statistic"</span>],</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    moran_black_after<span class="sc">$</span>estimate[<span class="st">"Moran I statistic"</span>]</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">P_Value =</span> <span class="fu">c</span>(</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    moran_crime_before<span class="sc">$</span>p.value,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    moran_crime_after<span class="sc">$</span>p.value,</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>    moran_black_before<span class="sc">$</span>p.value,</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>    moran_black_after<span class="sc">$</span>p.value</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    Variable Period  Morans_I      P_Value
1 Crime Rate Before 0.2694396 9.046675e-05
2 Crime Rate  After 0.3253130 7.910665e-06
3  Pct Black Before 0.5704901 3.365746e-13
4  Pct Black  After 0.5578784 9.091641e-13</code></pre>
</div>
</div></div>
</section>
<section id="local-morans-i-and-lisa-cluster-typology" class="level3">
<h3 class="anchored" data-anchor-id="local-morans-i-and-lisa-cluster-typology">Local Moran’s I and LISA Cluster Typology</h3>
<p>To identify localized clusters and spatial outliers, we compute Local Moran’s <span class="math inline">\(I\)</span> (LISA) for both crime rates and percent Black. We classify each precinct into one of five categories based on the sign of its standardized value and the sign of its spatial lag (neighbors’ average), conditional on statistical significance:</p>
<ul>
<li>High–High (hot spot): high value surrounded by high values</li>
<li>Low–Low (cold spot): low value surrounded by low values</li>
<li>High–Low: high outlier surrounded by low values</li>
<li>Low–High: low outlier surrounded by high values</li>
<li>Not significant</li>
</ul>
<p>The key substantive comparison is whether High–High crime precincts co-occur with High–High Black precincts, and whether the count (and identity) of overlapping precincts changes from the pre-period to the post-period.</p>
<p>We compute Local Moran’s I (LISA) statistics for both crime rate and percent Black in each period. Then we classify each precinct into cluster categories based on whether the precinct’s value and its neighbors’ average are both high (High-High), both low (Low-Low), or mismatched (High-Low, Low-High), conditional on statistical significance at p &lt; 0.05.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [18]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Local Moran's I</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>lisa_crime_before <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(precincts_before<span class="sc">$</span>crime_rate, weights_before)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>lisa_black_before <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(precincts_before<span class="sc">$</span>pct_black, weights_before)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>lisa_crime_after <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(precincts_after<span class="sc">$</span>crime_rate, weights_after)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>lisa_black_after <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(precincts_after<span class="sc">$</span>pct_black, weights_after)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to classify LISA clusters</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>get_lisa_clusters <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, lisa_output, weights) {</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">scale</span>(variable)[,<span class="dv">1</span>]</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  lag_z <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(weights, z)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> lisa_output[, <span class="dv">5</span>]</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  cluster <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    p_value <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Not Significant"</span>,</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_z <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-High"</span>,</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_z <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-Low"</span>,</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_z <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-Low"</span>,</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_z <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-High"</span>,</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Not Significant"</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cluster)</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to all four combinations</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>precincts_before<span class="sc">$</span>lisa_crime <span class="ot">&lt;-</span> <span class="fu">get_lisa_clusters</span>(</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>  precincts_before<span class="sc">$</span>crime_rate, lisa_crime_before, weights_before</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>precincts_before<span class="sc">$</span>lisa_black <span class="ot">&lt;-</span> <span class="fu">get_lisa_clusters</span>(</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>  precincts_before<span class="sc">$</span>pct_black, lisa_black_before, weights_before</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>precincts_after<span class="sc">$</span>lisa_crime <span class="ot">&lt;-</span> <span class="fu">get_lisa_clusters</span>(</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>  precincts_after<span class="sc">$</span>crime_rate, lisa_crime_after, weights_after</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>precincts_after<span class="sc">$</span>lisa_black <span class="ot">&lt;-</span> <span class="fu">get_lisa_clusters</span>(</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>  precincts_after<span class="sc">$</span>pct_black, lisa_black_after, weights_after</span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
<p>We tabulate the LISA cluster classifications to see how many precincts fall into each category for crime rate and percent Black, and how these counts changed between periods.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [19]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(precincts_before<span class="sc">$</span>lisa_crime))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
      High-High        Low-High         Low-Low Not Significant 
              6               1               1              68 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(precincts_after<span class="sc">$</span>lisa_crime))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
      High-High        Low-High         Low-Low Not Significant 
              5               1               1              69 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(precincts_before<span class="sc">$</span>lisa_black))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
      High-High        Low-High         Low-Low Not Significant 
              7               2               2              65 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(precincts_after<span class="sc">$</span>lisa_black))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
      High-High         Low-Low Not Significant 
              6               1              69 </code></pre>
</div>
</div></div>
<p>The key question for our analysis: which precincts are simultaneously hot spots for both crime and Black population? This overlap is central to claims about racially disparate policing. We identify precincts that are High-High for both variables and compare across periods.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [20]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Before period</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>overlap_before <span class="ot">&lt;-</span> precincts_before <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lisa_crime <span class="sc">==</span> <span class="st">"High-High"</span> <span class="sc">&amp;</span> lisa_black <span class="sc">==</span> <span class="st">"High-High"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(precinct, crime_rate, pct_black)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(overlap_before)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  precinct crime_rate pct_black
1       73   62.52496  81.73487
2       77   39.89329  72.30491
3       81   57.68057  80.20771</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># After period</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>overlap_after <span class="ot">&lt;-</span> precincts_after <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lisa_crime <span class="sc">==</span> <span class="st">"High-High"</span> <span class="sc">&amp;</span> lisa_black <span class="sc">==</span> <span class="st">"High-High"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(precinct, crime_rate, pct_black)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(overlap_after)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] precinct   crime_rate pct_black 
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div></div>
<p>We create a full cross-tabulation of crime clusters vs.&nbsp;Black population clusters to see the complete joint distribution, not just the High-High overlap.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [21]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(precincts_before<span class="sc">$</span>lisa_crime, precincts_before<span class="sc">$</span>lisa_black))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 
                  High-High Low-High Low-Low Not Significant
  High-High               3        1       0               2
  Low-High                0        0       0               1
  Low-Low                 0        0       1               0
  Not Significant         4        1       1              62</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(precincts_after<span class="sc">$</span>lisa_crime, precincts_after<span class="sc">$</span>lisa_black))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 
                  High-High Low-Low Not Significant
  High-High               0       0               5
  Low-High                0       0               1
  Low-Low                 0       1               0
  Not Significant         6       0              63</code></pre>
</div>
</div></div>
<p>We track specific precincts (73, 77, 81) that were identified as High-High for both crime and Black population in the before period to understand what happened to them in the after period—did they remain hot spots, or did their classification change?</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [22]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>track_precincts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"73"</span>, <span class="st">"77"</span>, <span class="st">"81"</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>precincts_before <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(precinct <span class="sc">%in%</span> track_precincts) <span class="sc">%&gt;%</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(precinct, total_crimes, crime_rate, pct_black, lisa_crime, lisa_black) <span class="sc">%&gt;%</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  precinct total_crimes crime_rate pct_black lisa_crime lisa_black
1       73         5411   62.52496  81.73487  High-High  High-High
2       77         3597   39.89329  72.30491  High-High  High-High
3       81         3621   57.68057  80.20771  High-High  High-High</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>precincts_after <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(precinct <span class="sc">%in%</span> track_precincts) <span class="sc">%&gt;%</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(precinct, total_crimes, crime_rate, pct_black, lisa_crime, lisa_black) <span class="sc">%&gt;%</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  precinct total_crimes crime_rate pct_black      lisa_crime      lisa_black
1       73        11034  111.95594  71.84071 Not Significant       High-High
2       77         6996   69.09301  50.39772 Not Significant       High-High
3       81         6978  101.23460  58.09961 Not Significant Not Significant</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>precincts_after <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lisa_crime <span class="sc">==</span> <span class="st">"High-High"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(precinct, crime_rate, pct_black, lisa_black) <span class="sc">%&gt;%</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  precinct crime_rate pct_black      lisa_black
1       40  111.83831  34.22379 Not Significant
2       41  149.35706  30.28773 Not Significant
3       42   84.09862  45.89912 Not Significant
4       43   57.14626  31.27506 Not Significant
5       44   74.37054  33.84694 Not Significant</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>precincts_after <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lisa_black <span class="sc">==</span> <span class="st">"High-High"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(precinct, crime_rate, pct_black, lisa_crime) <span class="sc">%&gt;%</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  precinct crime_rate pct_black      lisa_crime
1       67   63.86813  80.40893 Not Significant
2       63   31.22853  43.82666 Not Significant
3       69   49.08681  81.46211 Not Significant
4       73  111.95594  71.84071 Not Significant
5       77   69.09301  50.39772 Not Significant
6      100   47.37379  24.78987 Not Significant</code></pre>
</div>
</div></div>
</section>
<section id="monte-carlo-null-model-for-crime-clustering" class="level3">
<h3 class="anchored" data-anchor-id="monte-carlo-null-model-for-crime-clustering">Monte Carlo Null Model for Crime Clustering</h3>
<p>Global Moran’s <span class="math inline">\(I\)</span> can be statistically significant even under modest clustering when sample sizes are large; more importantly, observed clustering may reflect population distribution rather than any additional geographic process. We therefore implement a Monte Carlo simulation under a population-proportional null:</p>
<ul>
<li>The total number of crimes observed in a period is held fixed.</li>
<li>Crimes are randomly allocated to precincts with probability proportional to precinct population.</li>
<li>Simulated crime rates are computed and Moran’s <span class="math inline">\(I\)</span> is evaluated for each simulation.</li>
</ul>
<p>Let <span class="math inline">\(C\)</span> be the observed number of crimes in a period and <span class="math inline">\(p_p = \frac{Pop_p}{\sum_q Pop_q}\)</span>. A single simulation draws precinct crime counts:</p>
<p><span class="math display">\[
(C_1,\ldots,C_n) \sim \text{Multinomial}\left(C; p_1,\ldots,p_n\right)
\]</span></p>
<p>and constructs simulated rates <span class="math inline">\(CrimeRate_p^{(s)} = 1000 \times \frac{C_p}{Pop_p}\)</span>. Repeating this process yields an empirical null distribution of Moran’s <span class="math inline">\(I\)</span>. We compute the Monte Carlo p-value as the proportion of simulated Moran’s <span class="math inline">\(I\)</span> values greater than or equal to the observed <span class="math inline">\(I\)</span> (with a standard +1 correction):</p>
<p><span class="math display">\[
p = \frac{\#\{I^{(s)} \ge I^{obs}\} + 1}{S + 1}
\]</span></p>
<p>where <span class="math inline">\(S\)</span> is the number of simulations.</p>
<p>We define a function to run Monte Carlo simulations under the null hypothesis that crimes are distributed proportionally to population. For each simulation, we randomly allocate the observed total number of crimes to precincts using a multinomial distribution with probabilities equal to each precinct’s share of total population, compute crime rates, and calculate Moran’s I.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [23]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">65</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>simulate_morans_i <span class="ot">&lt;-</span> <span class="cf">function</span>(precincts_df, weights, <span class="at">n_sims =</span> <span class="dv">999</span>) {</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  total_crimes <span class="ot">&lt;-</span> <span class="fu">sum</span>(precincts_df<span class="sc">$</span>total_crimes)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  populations <span class="ot">&lt;-</span> precincts_df<span class="sc">$</span>total_pop_alloc</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  total_pop <span class="ot">&lt;-</span> <span class="fu">sum</span>(populations)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  pop_proportions <span class="ot">&lt;-</span> populations <span class="sc">/</span> total_pop</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  sim_morans <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sims)</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>    sim_crimes <span class="ot">&lt;-</span> <span class="fu">rmultinom</span>(<span class="dv">1</span>, <span class="at">size =</span> total_crimes, <span class="at">prob =</span> pop_proportions)[,<span class="dv">1</span>]</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>    sim_rate <span class="ot">&lt;-</span> (sim_crimes <span class="sc">/</span> populations) <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>    sim_rate[<span class="fu">is.infinite</span>(sim_rate)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>    sim_moran <span class="ot">&lt;-</span> <span class="fu">moran</span>(sim_rate, weights, <span class="at">n =</span> <span class="fu">length</span>(sim_rate), <span class="at">S0 =</span> <span class="fu">Szero</span>(weights))</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>    sim_morans[i] <span class="ot">&lt;-</span> sim_moran<span class="sc">$</span>I</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Completed"</span>, i, <span class="st">"of"</span>, n_sims, <span class="st">"simulations</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sim_morans)</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
<p>We run 999 Monte Carlo simulations for the before period and compare the observed Moran’s I to the null distribution. If the observed value falls in the extreme tail of the null distribution (p &lt; 0.05), we conclude that crime is more clustered than expected under population-proportional allocation alone.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [24]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>observed_moran_before <span class="ot">&lt;-</span> <span class="fu">moran</span>(</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  precincts_before<span class="sc">$</span>crime_rate, </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  weights_before, </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">nrow</span>(precincts_before), </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">S0 =</span> <span class="fu">Szero</span>(weights_before)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>I</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>sim_morans_before <span class="ot">&lt;-</span> <span class="fu">simulate_morans_i</span>(precincts_before, weights_before, <span class="at">n_sims =</span> <span class="dv">999</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Completed 100 of 999 simulations
Completed 200 of 999 simulations
Completed 300 of 999 simulations
Completed 400 of 999 simulations
Completed 500 of 999 simulations
Completed 600 of 999 simulations
Completed 700 of 999 simulations
Completed 800 of 999 simulations
Completed 900 of 999 simulations</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>p_value_before <span class="ot">&lt;-</span> (<span class="fu">sum</span>(sim_morans_before <span class="sc">&gt;=</span> observed_moran_before) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> (<span class="dv">999</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Mean simulated Moran's I:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(sim_morans_before), <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Mean simulated Moran's I: -0.0133</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  SD simulated Moran's I:"</span>, <span class="fu">round</span>(<span class="fu">sd</span>(sim_morans_before), <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  SD simulated Moran's I: 0.0875</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Observed Moran's I:"</span>, <span class="fu">round</span>(observed_moran_before, <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Observed Moran's I: 0.2694</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Monte Carlo p-value:"</span>, <span class="fu">round</span>(p_value_before, <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Monte Carlo p-value: 0.003</code></pre>
</div>
</div></div>
<p>We repeat the Monte Carlo simulation for the after period to assess whether “excess” clustering (beyond what population distribution would predict) changed after Patternizr implementation.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [25]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>observed_moran_after <span class="ot">&lt;-</span> <span class="fu">moran</span>(</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  precincts_after<span class="sc">$</span>crime_rate, </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  weights_after, </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">nrow</span>(precincts_after), </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">S0 =</span> <span class="fu">Szero</span>(weights_after)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>I</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>sim_morans_after <span class="ot">&lt;-</span> <span class="fu">simulate_morans_i</span>(precincts_after, weights_after, <span class="at">n_sims =</span> <span class="dv">999</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Completed 100 of 999 simulations
Completed 200 of 999 simulations
Completed 300 of 999 simulations
Completed 400 of 999 simulations
Completed 500 of 999 simulations
Completed 600 of 999 simulations
Completed 700 of 999 simulations
Completed 800 of 999 simulations
Completed 900 of 999 simulations</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>p_value_after <span class="ot">&lt;-</span> (<span class="fu">sum</span>(sim_morans_after <span class="sc">&gt;=</span> observed_moran_after) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> (<span class="dv">999</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Mean simulated Moran's I:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(sim_morans_after), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Mean simulated Moran's I: -0.0104 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  SD simulated Moran's I:"</span>, <span class="fu">round</span>(<span class="fu">sd</span>(sim_morans_after), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  SD simulated Moran's I: 0.0851 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Observed Moran's I:"</span>, <span class="fu">round</span>(observed_moran_after, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Observed Moran's I: 0.3253 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Monte Carlo p-value:"</span>, <span class="fu">round</span>(p_value_after, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Monte Carlo p-value: 0.002 </code></pre>
</div>
</div></div>
<p>We visualize the Monte Carlo results by plotting histograms of the simulated Moran’s I distributions with the observed values marked as vertical lines. This makes it easy to see whether the observed clustering is extreme relative to the null.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [26]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>sim_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Morans_I =</span> <span class="fu">c</span>(sim_morans_before, sim_morans_after),</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Period =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Before (2010-2012)"</span>, <span class="st">"After (2013-2019)"</span>), <span class="at">each =</span> <span class="dv">999</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>observed_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Morans_I =</span> <span class="fu">c</span>(observed_moran_before, observed_moran_after),</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Period =</span> <span class="fu">c</span>(<span class="st">"Before (2010-2012)"</span>, <span class="st">"After (2013-2019)"</span>)</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>monte_carlo_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sim_df, <span class="fu">aes</span>(<span class="at">x =</span> Morans_I)) <span class="sc">+</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> observed_df, <span class="fu">aes</span>(<span class="at">xintercept =</span> Morans_I), </span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Period, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monte Carlo Simulation: Crime Rate Spatial Autocorrelation"</span>,</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Null hypothesis: Crime distributed proportionally to population"</span>,</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Moran's I"</span>,</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frequency"</span>,</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Red dashed line = Observed Moran's I"</span></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(monte_carlo_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="index_files/figure-html/monte-carlo-plot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/monte-carlo-plot-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div></div>
<p>We compile the Monte Carlo results into a summary table and provide interpretations of what the p-values mean for our research questions.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [27]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>mc_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Period =</span> <span class="fu">c</span>(<span class="st">"Before (2010-2012)"</span>, <span class="st">"After (2013-2019)"</span>),</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Observed_Morans_I =</span> <span class="fu">c</span>(observed_moran_before, observed_moran_after),</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_Simulated =</span> <span class="fu">c</span>(<span class="fu">mean</span>(sim_morans_before), <span class="fu">mean</span>(sim_morans_after)),</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">SD_Simulated =</span> <span class="fu">c</span>(<span class="fu">sd</span>(sim_morans_before), <span class="fu">sd</span>(sim_morans_after)),</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">P_Value =</span> <span class="fu">c</span>(p_value_before, p_value_after)</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mc_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              Period Observed_Morans_I Mean_Simulated SD_Simulated P_Value
1 Before (2010-2012)         0.2694396    -0.01333626   0.08746933   0.003
2  After (2013-2019)         0.3253130    -0.01042705   0.08507049   0.002</code></pre>
</div>
</div></div>
</section>
<section id="geographically-weighted-regression" class="level3">
<h3 class="anchored" data-anchor-id="geographically-weighted-regression">Geographically Weighted Regression</h3>
<p>Finally, we fit geographically weighted regression (GWR) models in each period to assess spatial non-stationarity in the association between racial composition and crime rates. For precinct <span class="math inline">\(p\)</span> with coordinates <span class="math inline">\((u_p, v_p)\)</span>, GWR estimates location-specific coefficients:</p>
<p><span class="math display">\[
CrimeRate_p = \beta_0(u_p,v_p) + \beta_1(u_p,v_p)\%Black_p + \beta_2(u_p,v_p)\%Hispanic_p + \beta_3(u_p,v_p)\%White_p + \varepsilon_p
\]</span></p>
<p>An adaptive bandwidth is selected via the standard GWR bandwidth selection routine, and local coefficients (particularly <span class="math inline">\(\beta_1(u_p,v_p)\)</span>) are mapped for visual comparison across periods. This component is explicitly diagnostic: changes in coefficient heterogeneity can reflect shifts in policing geography, demographic change, or other local dynamics; thus, results are interpreted as evidence of spatial variation rather than causal impact.</p>
<p>We load the <code>spgwr</code> package and prepare our data for GWR analysis. GWR requires point coordinates (we use precinct centroids) and fits a separate regression at each location, weighting nearby observations more heavily. We use adaptive bandwidth selection, which chooses the bandwidth that minimizes cross-validation error.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [28]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spgwr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: This package does not constitute approval of GWR
as a method of spatial analysis; see example(gwr)</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for GWR - BEFORE period</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>precincts_gwr_before <span class="ot">&lt;-</span> precincts_before <span class="sc">%&gt;%</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(crime_rate), <span class="sc">!</span><span class="fu">is.na</span>(pct_black), <span class="sc">!</span><span class="fu">is.na</span>(pct_hispanic), <span class="sc">!</span><span class="fu">is.na</span>(pct_white))</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>coords_before <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(precincts_gwr_before))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>precincts_sp_before <span class="ot">&lt;-</span> <span class="fu">as</span>(precincts_gwr_before, <span class="st">"Spatial"</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>bw_before <span class="ot">&lt;-</span> <span class="fu">gwr.sel</span>(</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  crime_rate <span class="sc">~</span> pct_black <span class="sc">+</span> pct_hispanic <span class="sc">+</span> pct_white,</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> precincts_sp_before,</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> coords_before,</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt =</span> <span class="cn">TRUE</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in gwr.sel(crime_rate ~ pct_black + pct_hispanic + pct_white, data =
precincts_sp_before, : data is Spatial* object, ignoring coords argument</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Adaptive q: 0.381966 CV score: 14999.83 
Adaptive q: 0.618034 CV score: 15097.84 
Adaptive q: 0.236068 CV score: 15085.6 
Adaptive q: 0.4209454 CV score: 15005.67 
Adaptive q: 0.382664 CV score: 15000.59 
Adaptive q: 0.3262379 CV score: 15015.89 
Adaptive q: 0.3606798 CV score: 15022.54 
Adaptive q: 0.3738354 CV score: 15010.12 
Adaptive q: 0.3788604 CV score: 15003.06 
Adaptive q: 0.3813392 CV score: 14999.72 
Adaptive q: 0.3815285 CV score: 14999.47 
Adaptive q: 0.3816274 CV score: 14999.45 
Adaptive q: 0.3816681 CV score: 14999.5 
Adaptive q: 0.3815867 CV score: 14999.41 
Adaptive q: 0.3815867 CV score: 14999.41 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>gwr_before <span class="ot">&lt;-</span> <span class="fu">gwr</span>(</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  crime_rate <span class="sc">~</span> pct_black <span class="sc">+</span> pct_hispanic <span class="sc">+</span> pct_white,</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> precincts_sp_before,</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> coords_before,</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt =</span> bw_before,</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">hatmatrix =</span> <span class="cn">TRUE</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in gwr(crime_rate ~ pct_black + pct_hispanic + pct_white, data =
precincts_sp_before, : data is Spatial* object, ignoring coords argument</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gwr_before)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
gwr(formula = crime_rate ~ pct_black + pct_hispanic + pct_white, 
    data = precincts_sp_before, coords = coords_before, adapt = bw_before, 
    hatmatrix = TRUE)
Kernel function: gwr.Gauss 
Adaptive quantile: 0.3815867 (about 29 of 76 data points)
Summary of GWR coefficient estimates at data points:
                   Min.    1st Qu.     Median    3rd Qu.       Max.  Global
X.Intercept. 28.7125865 30.2015845 31.6285635 32.4752874 34.2351855 32.1571
pct_black     0.2328434  0.2780089  0.3176021  0.3579805  0.4033567  0.3097
pct_hispanic -0.2523239 -0.2034498 -0.1544861 -0.1023741 -0.0356422 -0.1718
pct_white    -0.1112431 -0.0608376 -0.0064229  0.0408800  0.0943873 -0.0113
Number of data points: 76 
Effective number of parameters (residual: 2traceS - traceS'S): 8.473558 
Effective degrees of freedom (residual: 2traceS - traceS'S): 67.52644 
Sigma (residual: 2traceS - traceS'S): 13.77924 
Effective number of parameters (model: traceS): 6.733035 
Effective degrees of freedom (model: traceS): 69.26697 
Sigma (model: traceS): 13.60501 
Sigma (ML): 12.98839 
AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 622.8891 
AIC (GWR p. 96, eq. 4.22): 612.1482 
Residual sum of squares: 12821.06 
Quasi-global R2: 0.35847 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for GWR - AFTER period</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>precincts_gwr_after <span class="ot">&lt;-</span> precincts_after <span class="sc">%&gt;%</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(crime_rate), <span class="sc">!</span><span class="fu">is.na</span>(pct_black), <span class="sc">!</span><span class="fu">is.na</span>(pct_hispanic), <span class="sc">!</span><span class="fu">is.na</span>(pct_white))</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>coords_after <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(precincts_gwr_after))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>precincts_sp_after <span class="ot">&lt;-</span> <span class="fu">as</span>(precincts_gwr_after, <span class="st">"Spatial"</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>bw_after <span class="ot">&lt;-</span> <span class="fu">gwr.sel</span>(</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  crime_rate <span class="sc">~</span> pct_black <span class="sc">+</span> pct_hispanic <span class="sc">+</span> pct_white,</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> precincts_sp_after,</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> coords_after,</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt =</span> <span class="cn">TRUE</span></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in gwr.sel(crime_rate ~ pct_black + pct_hispanic + pct_white, data =
precincts_sp_after, : data is Spatial* object, ignoring coords argument</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Adaptive q: 0.381966 CV score: 48175.64 
Adaptive q: 0.618034 CV score: 49126.83 
Adaptive q: 0.236068 CV score: 46703.21 
Adaptive q: 0.145898 CV score: 45577.51 
Adaptive q: 0.09016994 CV score: 43538.98 
Adaptive q: 0.05572809 CV score: 39851.21 
Adaptive q: 0.03444185 CV score: 36840.96 
Adaptive q: 0.02128624 CV score: 36701.45 
Adaptive q: 0.02646805 CV score: 36922.68 
Adaptive q: 0.01315562 CV score: 40241.2 
Adaptive q: 0.01818062 CV score: 37380.23 
Adaptive q: 0.02326551 CV score: 36675.14 
Adaptive q: 0.02538445 CV score: 36822.93 
Adaptive q: 0.02260392 CV score: 36659.83 
Adaptive q: 0.02251629 CV score: 36659.38 
Adaptive q: 0.02245394 CV score: 36659.31 
Adaptive q: 0.02241325 CV score: 36659.38 
Adaptive q: 0.02245394 CV score: 36659.31 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>gwr_after <span class="ot">&lt;-</span> <span class="fu">gwr</span>(</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  crime_rate <span class="sc">~</span> pct_black <span class="sc">+</span> pct_hispanic <span class="sc">+</span> pct_white,</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> precincts_sp_after,</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> coords_after,</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt =</span> bw_after,</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">hatmatrix =</span> <span class="cn">TRUE</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in gwr(crime_rate ~ pct_black + pct_hispanic + pct_white, data =
precincts_sp_after, : data is Spatial* object, ignoring coords argument</code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gwr_after)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
gwr(formula = crime_rate ~ pct_black + pct_hispanic + pct_white, 
    data = precincts_sp_after, coords = coords_after, adapt = bw_after, 
    hatmatrix = TRUE)
Kernel function: gwr.Gauss 
Adaptive quantile: 0.02245394 (about 1 of 76 data points)
Summary of GWR coefficient estimates at data points:
                   Min.    1st Qu.     Median    3rd Qu.       Max. Global
X.Intercept. -322.72792  -77.75389   -5.74549   34.18227  541.57804 9.3732
pct_black      -3.74664    0.81629    1.26496    2.13543   18.17959 0.8241
pct_hispanic   -8.50157    0.19041    0.83417    1.77788    3.85127 0.6552
pct_white      -6.37656   -0.26404    0.31961    0.77214    4.35870 0.1583
Number of data points: 76 
Effective number of parameters (residual: 2traceS - traceS'S): 49.81015 
Effective degrees of freedom (residual: 2traceS - traceS'S): 26.18985 
Sigma (residual: 2traceS - traceS'S): 12.98531 
Effective number of parameters (model: traceS): 39.23732 
Effective degrees of freedom (model: traceS): 36.76268 
Sigma (model: traceS): 10.96012 
Sigma (ML): 7.622758 
AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 700.3496 
AIC (GWR p. 96, eq. 4.22): 563.649 
Residual sum of squares: 4416.09 
Quasi-global R2: 0.9391351 </code></pre>
</div>
</div></div>
<p>We extract the local coefficients from the GWR model results. Each precinct has its own estimated coefficient for percent Black, which tells us the local relationship between racial composition and crime rates at that location.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [29]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficients from GWR results</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>gwr_coefs_before <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(gwr_before<span class="sc">$</span>SDF)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>gwr_coefs_after <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(gwr_after<span class="sc">$</span>SDF)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to sf objects</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>precincts_gwr_before<span class="sc">$</span>gwr_pct_black <span class="ot">&lt;-</span> gwr_coefs_before<span class="sc">$</span>pct_black</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>precincts_gwr_before<span class="sc">$</span>gwr_intercept <span class="ot">&lt;-</span> gwr_coefs_before<span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>precincts_gwr_before<span class="sc">$</span>gwr_localR2 <span class="ot">&lt;-</span> gwr_coefs_before<span class="sc">$</span>localR2</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>precincts_gwr_after<span class="sc">$</span>gwr_pct_black <span class="ot">&lt;-</span> gwr_coefs_after<span class="sc">$</span>pct_black</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>precincts_gwr_after<span class="sc">$</span>gwr_intercept <span class="ot">&lt;-</span> gwr_coefs_after<span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>precincts_gwr_after<span class="sc">$</span>gwr_localR2 <span class="ot">&lt;-</span> gwr_coefs_after<span class="sc">$</span>localR2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
<p>We create maps showing the local percent Black coefficient across NYC precincts for both periods. Red indicates a stronger positive relationship between percent Black and crime rate at that location; blue indicates a weaker or negative relationship. Comparing these maps reveals whether the race-crime relationship became more spatially heterogeneous after Patternizr.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [30]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get consistent color scale</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>coef_range <span class="ot">&lt;-</span> <span class="fu">range</span>(<span class="fu">c</span>(precincts_gwr_before<span class="sc">$</span>gwr_pct_black, precincts_gwr_after<span class="sc">$</span>gwr_pct_black))</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>gwr_map_before <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(precincts_gwr_before) <span class="sc">+</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gwr_pct_black), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"#377EB8"</span>,</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"#E41A1C"</span>,</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Local</span><span class="sc">\n</span><span class="st">Coefficient"</span>,</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> coef_range</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"BEFORE (2010-2012)"</span>) <span class="sc">+</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>gwr_map_after <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(precincts_gwr_after) <span class="sc">+</span></span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gwr_pct_black), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"#377EB8"</span>,</span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb133-27"><a href="#cb133-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"#E41A1C"</span>,</span>
<span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Local</span><span class="sc">\n</span><span class="st">Coefficient"</span>,</span>
<span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> coef_range</span>
<span id="cb133-31"><a href="#cb133-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb133-32"><a href="#cb133-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb133-33"><a href="#cb133-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AFTER (2013-2019)"</span>) <span class="sc">+</span></span>
<span id="cb133-34"><a href="#cb133-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb133-35"><a href="#cb133-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb133-36"><a href="#cb133-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb133-37"><a href="#cb133-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb133-38"><a href="#cb133-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-39"><a href="#cb133-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-40"><a href="#cb133-40" aria-hidden="true" tabindex="-1"></a>gwr_comparison <span class="ot">&lt;-</span> gwr_map_before <span class="sc">+</span> gwr_map_after <span class="sc">+</span></span>
<span id="cb133-41"><a href="#cb133-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb133-42"><a href="#cb133-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GWR: Local Effect of % Black on Crime Rate"</span>,</span>
<span id="cb133-43"><a href="#cb133-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Red = stronger positive relationship; Blue = weaker/negative relationship"</span></span>
<span id="cb133-44"><a href="#cb133-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-45"><a href="#cb133-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-46"><a href="#cb133-46" aria-hidden="true" tabindex="-1"></a><span class="co"># print(gwr_comparison)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
<p>We also map the local R² values from GWR, which show how well the demographic model explains crime rate variation at each location. Higher values indicate that demographics are more predictive of crime in that area.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [31]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>r2_range <span class="ot">&lt;-</span> <span class="fu">range</span>(<span class="fu">c</span>(precincts_gwr_before<span class="sc">$</span>gwr_localR2, precincts_gwr_after<span class="sc">$</span>gwr_localR2))</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>r2_map_before <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(precincts_gwr_before) <span class="sc">+</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gwr_localR2), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">name =</span> <span class="st">"Local R²"</span>, <span class="at">limits =</span> r2_range) <span class="sc">+</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"BEFORE (2010-2012)"</span>) <span class="sc">+</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>r2_map_after <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(precincts_gwr_after) <span class="sc">+</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gwr_localR2), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">name =</span> <span class="st">"Local R²"</span>, <span class="at">limits =</span> r2_range) <span class="sc">+</span></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AFTER (2013-2019)"</span>) <span class="sc">+</span></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>r2_comparison <span class="ot">&lt;-</span> r2_map_before <span class="sc">+</span> r2_map_after <span class="sc">+</span></span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GWR: Local Model Fit (R²)"</span>,</span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Higher = demographics explain more crime variation in that area"</span></span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a><span class="co"># print(r2_comparison)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div>
<p>We summarize the distribution of local percent Black coefficients across precincts to quantify how much the race-crime relationship varies spatially and how this variation changed between periods.</p>
<div class="cell-container code-fold"><div class="cell-decorator"><pre>In [32]:</pre></div><div class="cell">
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(precincts_gwr_before<span class="sc">$</span>gwr_pct_black))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.2328  0.2780  0.3176  0.3183  0.3580  0.4034 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(precincts_gwr_after<span class="sc">$</span>gwr_pct_black))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-3.7466  0.8163  1.2650  2.4041  2.1354 18.1796 </code></pre>
</div>
</div></div>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="global-spatial-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="global-spatial-autocorrelation">Global spatial autocorrelation</h3>
<p>Violent felony crime rates exhibit statistically meaningful positive spatial autocorrelation in both periods. Before Patternizr, the Global Moran’s I for precinct crime rate was <span class="math inline">\(I = 0.269\)</span>, indicating moderate spatial clustering. In the post-Patternizr period (2013–2019), this clustering strengthened to <span class="math inline">\(I = 0.341\)</span>, suggesting that high- and low-crime precincts became more geographically concentrated over time.</p>
<p>Racial composition is substantially more spatially clustered than crime in both periods. The Global Moran’s I for percent Black population was <span class="math inline">\(I = 0.570\)</span> in 2010–2012 and remained comparably high in 2013–2019 (<span class="math inline">\(I = 0.558\)</span>). This persistence is consistent with stable patterns of residential segregation at the precinct scale. Notably, while crime clustering increased across periods, the degree of racial clustering changed only marginally.</p>
</section>
<section id="local-clustering-and-overlap-of-crime-and-race-hot-spots" class="level3">
<h3 class="anchored" data-anchor-id="local-clustering-and-overlap-of-crime-and-race-hot-spots">Local clustering and overlap of crime and race “hot spots”</h3>
<p>Local Indicators of Spatial Association (LISA) provide a complementary view of these patterns. The number of High–High crime clusters decreased from 6 precincts in 2010–2012 to 4 precincts in 2013–2019, indicating fewer statistically significant violent-crime hot spots in the later period. The number of High–High Black population clusters also declined slightly (from 7 to 6 precincts), again suggesting that the spatial concentration of Black population remained largely stable.</p>
<p>The most consequential local result concerns the intersection of these cluster types. In the pre-Patternizr period, 3 precincts were simultaneously classified as High–High for crime rates and High–High for Black population share.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="lisa_crime_comparison.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="LISA cluster classifications for violent felony crime rates by precinct before (2010–2012) vs after (2013–2019) Patternizr."><img src="lisa_crime_comparison.png" class="img-fluid figure-img" alt="LISA cluster classifications for violent felony crime rates by precinct before (2010–2012) vs after (2013–2019) Patternizr."></a></p>
<figcaption>LISA cluster classifications for violent felony crime rates by precinct before (2010–2012) vs after (2013–2019) Patternizr.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="lisa_black_comparison.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="LISA cluster classifications for percent Black population by precinct (2010 Census vs 2020 Census)."><img src="lisa_black_comparison.png" class="img-fluid figure-img" alt="LISA cluster classifications for percent Black population by precinct (2010 Census vs 2020 Census)."></a></p>
<figcaption>LISA cluster classifications for percent Black population by precinct (2010 Census vs 2020 Census).</figcaption>
</figure>
</div>
<p>In the post-Patternizr period, this overlap fell to 0 precincts. Thus, while both crime and race remained spatially clustered in their own right, the geographic coincidence of Black-population hot spots with violent-crime hot spots disappeared in the post-implementation period.</p>
</section>
<section id="monte-carlo-evidence-of-excess-clustering-beyond-population-distribution" class="level3">
<h3 class="anchored" data-anchor-id="monte-carlo-evidence-of-excess-clustering-beyond-population-distribution">Monte Carlo evidence of “excess” clustering beyond population distribution</h3>
<p>Monte Carlo simulations further indicate that the observed crime clustering is unlikely to be attributable to population distribution alone. Under a null model in which crimes are allocated proportionally to precinct population, the probability of observing crime-rate Moran’s I values as large as those measured is small in both periods (pre: <span class="math inline">\(p = 0.003\)</span>; post: <span class="math inline">\(p = 0.001\)</span>). These results imply that violent crime is significantly more spatially clustered than expected under population-proportional allocation, and that this “excess” clustering is at least as pronounced—if not more pronounced—in the post-Patternizr period.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="monte_carlo_simulation.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Monte Carlo null distributions of Moran’s I for crime rates under a population-proportional allocation model."><img src="monte_carlo_simulation.png" class="img-fluid figure-img" alt="Monte Carlo null distributions of Moran’s I for crime rates under a population-proportional allocation model."></a></p>
<figcaption>Monte Carlo null distributions of Moran’s I for crime rates under a population-proportional allocation model.</figcaption>
</figure>
</div>
</section>
<section id="geographically-weighted-regression-1" class="level3">
<h3 class="anchored" data-anchor-id="geographically-weighted-regression-1">Geographically Weighted Regression</h3>
<p>To assess spatial non-stationarity in the race–crime relationship, we fit geographically weighted regression (GWR) models in each period with precinct violent felony rate as the dependent variable and percent Black, percent Hispanic, and percent White as predictors. Across both periods, the GWR results indicate that the form of the demographic–crime relationship changes substantially after Patternizr, shifting from relatively smooth spatial variation to extreme localization and heterogeneity.</p>
<p>In the pre-Patternizr period (2010–2012), the optimal adaptive bandwidth selected by cross-validation was <span class="math inline">\(q \approx 0.382\)</span>, corresponding to approximately 29 of 76 precincts contributing to each local estimate. This relatively large bandwidth implies that local coefficients are estimated using broad neighborhood information, producing a comparatively smooth spatial surface.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="gwr_pct_black_comparison.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Geographically weighted regression (GWR) local coefficients for percent Black predicting violent felony crime rate."><img src="gwr_pct_black_comparison.png" class="img-fluid figure-img" alt="Geographically weighted regression (GWR) local coefficients for percent Black predicting violent felony crime rate."></a></p>
<figcaption>Geographically weighted regression (GWR) local coefficients for percent Black predicting violent felony crime rate.</figcaption>
</figure>
</div>
<p>Consistent with this, the local %Black coefficient is uniformly positive and tightly distributed across precincts (min = 0.2328, median = 0.3176, max = 0.4034; mean = 0.3183). The quasi-global <span class="math inline">\(R^2\)</span> is 0.3585, indicating that allowing coefficients to vary spatially yields a moderate improvement in explanatory power relative to a purely global specification.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="gwr_localR2_comparison.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="GWR local R² surfaces for 2010–2012 vs 2013–2019."><img src="gwr_localR2_comparison.png" class="img-fluid figure-img" alt="GWR local R² surfaces for 2010–2012 vs 2013–2019."></a></p>
<figcaption>GWR local R² surfaces for 2010–2012 vs 2013–2019.</figcaption>
</figure>
</div>
<p>In the post-Patternizr period (2013–2019), the optimal bandwidth shrinks dramatically to <span class="math inline">\(q \approx 0.022\)</span>, corresponding to approximately 1 of 76 precincts contributing to each local estimate. This indicates an extremely localized specification and a strong departure from spatial stationarity. The distribution of local %Black coefficients expands sharply and changes qualitatively: coefficients range from negative to extremely large positive values (min = −3.7466, median = 1.2650, max = 18.1796; mean = 2.4041). The quasi-global <span class="math inline">\(R^2\)</span> rises to 0.9391, suggesting that the model—when permitted to vary at highly local scales—captures a very large share of precinct-level variation in crime rates.</p>
<p>However, the post-period GWR fit must be interpreted cautiously. The effective number of parameters increases markedly (approximately 39.2 in the post-period versus 6.7 in the pre-period), reflecting substantially greater model flexibility. As a result, the dramatic increase in quasi-global <span class="math inline">\(R^2\)</span> is consistent with heightened spatial heterogeneity but may also reflect overfitting induced by the extremely small adaptive bandwidth.</p>
</section>
</section>
<section id="interpretation" class="level2">
<h2 class="anchored" data-anchor-id="interpretation">Interpretation</h2>
<p>Synthesizing the global, local, and GWR results yields a coherent descriptive pattern. First, violent crime becomes more spatially clustered after Patternizr (Moran’s I: 0.269 → 0.341), and this clustering is stronger than would be expected under a population-proportional null model in both periods (Monte Carlo <span class="math inline">\(p = 0.003\)</span> pre; <span class="math inline">\(p = 0.001\)</span> post). Second, racial composition remains highly clustered and changes little between periods (<span class="math inline">\(I = 0.570\)</span> pre; <span class="math inline">\(I = 0.558\)</span> post), indicating that segregation-like spatial structure persists regardless of policing regime. Third, despite these persistent forms of clustering, the spatial coincidence of Black-population hot spots and violent-crime hot spots disappears (overlap: 3 → 0 precincts).</p>
<p>The GWR results provide a plausible statistical complement to this spatial decoupling: before Patternizr, the association between %Black and crime rate is consistently positive and spatially smooth, whereas after Patternizr the relationship becomes sharply non-stationary, varying widely in magnitude and even sign across precincts. In practical terms, this implies that the post-Patternizr period is less well described by a single citywide race–crime gradient and more consistent with localized, place-specific dynamics. Importantly, this change is observational and does not, by itself, identify a causal effect of Patternizr. The post-period encompasses substantial social and demographic change, and the extreme localization implied by the selected bandwidth suggests that any causal interpretation would require additional identification strategies and sensitivity analyses.</p>
<!-- -->

</section>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb139" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Examining Claims of Racial Bias in Predictive Policing through a Geographic Perspective"</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Hide code"</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a><span class="an">authors:</span></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Fareeza Ali and Jackson Howes</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Georgetown University</span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: true</span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a><span class="fu">## Abstract</span></span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a>Predictive policing systems have been repeatedly criticized for reproducing and amplifying racial disparities, yet empirical evaluation is complicated by the fact that "crime data" are not neutral measurements of underlying criminal behavior but administrative records produced through enforcement, reporting, and institutional decision-making. In this manuscript, we assess whether spatial patterns in recorded violent felony incidents changed in ways consistent with the claim that algorithmic policing intensified racially disparate enforcement. We adopt a geographic perspective, using NYPD precincts as the unit of analysis, violent felony complaint records as the outcome, and census-derived racial composition as the principal demographic covariate. Our design compares a pre-period (2010–2012) and a post-period (2013–2019) bracketing the implementation window of Patternizr, a predictive policing system introduced by the NYPD in 2013. We quantify global spatial autocorrelation in both crime rates and Black population share using Moran's $I$, identify local clusters using Local Indicators of Spatial Association (LISA), and assess whether observed clustering exceeds what would be expected under a population-proportional null model via Monte Carlo simulation. Finally, we use geographically weighted regression (GWR) to examine whether the relationship between racial composition and recorded crime rates became more spatially heterogeneous over time. We emphasize throughout that any observed differences are associational rather than causal, given concurrent neighborhood change and other confounds; nonetheless, this framework isolates concrete spatial signatures that are directly relevant to claims of algorithmically mediated bias.</span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb139-25"><a href="#cb139-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-26"><a href="#cb139-26" aria-hidden="true" tabindex="-1"></a>Public and scholarly debates over predictive policing have increasingly centered on a shared concern: that algorithmic systems trained on historically patterned enforcement data may re-entrench and intensify the very disparities they purport to mitigate. In the specific context of New York City, Patternizr has been described as a tool intended to assist in recognizing potentially related crime patterns; however, even systems framed as investigative aids may shape enforcement attention and thereby the geography of recorded crime. When police deploy resources unevenly across space, administrative "crime" data can reflect both underlying incidents and the spatial distribution of policing itself. As a result, testing claims of algorithmic bias requires methodological approaches that can separate (or at minimum, describe) changes in spatial concentration and demographic overlap.</span>
<span id="cb139-27"><a href="#cb139-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-28"><a href="#cb139-28" aria-hidden="true" tabindex="-1"></a>We therefore pose a geographically grounded question: did the spatial structure of recorded violent felony crime become more clustered after the implementation of Patternizr, and did the geography of those clusters align differently with the geography of Black residential concentration? Importantly, our inferential target is not a direct causal estimate of Patternizr's effect. Instead, we evaluate whether the *spatial signatures* of recorded crime—global clustering, local hot spots, and hot-spot overlap with racially concentrated precincts—changed in ways that are consistent with common critiques of predictive policing. We explicitly treat demographic change, including gentrification and population redistribution between 2010 and 2020, as a major confound that must be described alongside any policing-related interpretation.</span>
<span id="cb139-29"><a href="#cb139-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-30"><a href="#cb139-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Research Questions and Hypotheses</span></span>
<span id="cb139-31"><a href="#cb139-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-32"><a href="#cb139-32" aria-hidden="true" tabindex="-1"></a>Our analysis is organized around three primary research questions.</span>
<span id="cb139-33"><a href="#cb139-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-34"><a href="#cb139-34" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Did the spatial clustering of violent felony *crime rates* change between the pre-Patternizr and post-Patternizr periods?**</span>
<span id="cb139-35"><a href="#cb139-35" aria-hidden="true" tabindex="-1"></a>   If predictive policing concentrated enforcement attention into a narrower set of precincts, we would expect increased spatial autocorrelation in recorded crime rates. This motivates comparison of global Moran's $I$ for precinct-level crime rates across periods.</span>
<span id="cb139-36"><a href="#cb139-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-37"><a href="#cb139-37" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Did the spatial clustering of Black residential concentration change over the same window, and how does it relate to crime clustering?**</span>
<span id="cb139-38"><a href="#cb139-38" aria-hidden="true" tabindex="-1"></a>   Racial residential segregation produces strong spatial autocorrelation in demographic composition. If this structure is stable while crime clustering changes, then changes in the *relationship* between demographic clustering and crime clustering become substantively interpretable.</span>
<span id="cb139-39"><a href="#cb139-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-40"><a href="#cb139-40" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Did the overlap between crime hot spots and Black population hot spots change?**</span>
<span id="cb139-41"><a href="#cb139-41" aria-hidden="true" tabindex="-1"></a>   We operationalize "hot spot" using LISA High–High clusters. A reduction in overlap may indicate either (i) a weakening association between racial concentration and recorded crime hot spots, or (ii) demographic change in the precincts that previously occupied both categories.</span>
<span id="cb139-42"><a href="#cb139-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-43"><a href="#cb139-43" aria-hidden="true" tabindex="-1"></a>In addition, we use geographically weighted regression (GWR) as a diagnostic to evaluate whether the local association between percent Black and precinct crime rates became more spatially heterogeneous over time. Substantively, a shift toward stronger spatial non-stationarity is consistent with a more localized policing geography, but this pattern can also arise from localized neighborhood change and other place-specific dynamics.</span>
<span id="cb139-44"><a href="#cb139-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-45"><a href="#cb139-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data and Study Design</span></span>
<span id="cb139-46"><a href="#cb139-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-47"><a href="#cb139-47" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setup and Load Libraries</span></span>
<span id="cb139-48"><a href="#cb139-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-49"><a href="#cb139-49" aria-hidden="true" tabindex="-1"></a>We begin by loading all required R packages for spatial analysis. The <span class="in">`tidyverse`</span> provides data manipulation tools, <span class="in">`sf`</span> handles spatial vector data, <span class="in">`tidycensus`</span> and <span class="in">`tigris`</span> allow us to pull Census data and geographic boundaries directly from the Census API, <span class="in">`spdep`</span> provides spatial autocorrelation and neighbor-based statistics, and <span class="in">`patchwork`</span> enables combining multiple ggplot figures.</span>
<span id="cb139-50"><a href="#cb139-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-53"><a href="#cb139-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-54"><a href="#cb139-54" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup-libraries</span></span>
<span id="cb139-55"><a href="#cb139-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-56"><a href="#cb139-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb139-57"><a href="#cb139-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb139-58"><a href="#cb139-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb139-59"><a href="#cb139-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb139-60"><a href="#cb139-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb139-61"><a href="#cb139-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb139-62"><a href="#cb139-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-63"><a href="#cb139-63" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tigris_use_cache =</span> <span class="cn">TRUE</span>)</span>
<span id="cb139-64"><a href="#cb139-64" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tigris_progress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb139-65"><a href="#cb139-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-66"><a href="#cb139-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-67"><a href="#cb139-67" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatial Units and Coordinate Systems</span></span>
<span id="cb139-68"><a href="#cb139-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-69"><a href="#cb139-69" aria-hidden="true" tabindex="-1"></a>The unit of analysis is each NYPD precinct. We load an official precinct boundary shapefile and project it to an equal-area / planar coordinate system appropriate for spatial operations (EPSG:32118). All spatial overlays and neighborhood constructions (contiguity weights) are conducted in this projected CRS to ensure that area calculations and adjacency relationships are well-defined.</span>
<span id="cb139-70"><a href="#cb139-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-71"><a href="#cb139-71" aria-hidden="true" tabindex="-1"></a>We load the precinct boundary shapefile from a local GeoJSON file and transform it from WGS84 (latitude/longitude) to the New York State Plane coordinate system (EPSG:32118). This projected coordinate system uses meters as units, which is essential for accurate area calculations during the areal interpolation step.</span>
<span id="cb139-72"><a href="#cb139-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-75"><a href="#cb139-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-76"><a href="#cb139-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-precincts</span></span>
<span id="cb139-77"><a href="#cb139-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-78"><a href="#cb139-78" aria-hidden="true" tabindex="-1"></a>precincts <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"../data/nyc_precincts.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb139-79"><a href="#cb139-79" aria-hidden="true" tabindex="-1"></a>precincts_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(precincts, <span class="dv">32118</span>)</span>
<span id="cb139-80"><a href="#cb139-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-81"><a href="#cb139-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-82"><a href="#cb139-82" aria-hidden="true" tabindex="-1"></a><span class="fu">### Demographic Data: Census Blocks to Precincts via Areal Interpolation</span></span>
<span id="cb139-83"><a href="#cb139-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-84"><a href="#cb139-84" aria-hidden="true" tabindex="-1"></a>Because precinct boundaries do not align with census block boundaries, we construct precinct-level demographics using areal interpolation. Specifically, we obtain census block geometries and block-level decennial census counts for 2010 and 2020. For each census year, we intersect census blocks with precinct polygons, compute the proportion of each block's area contained within each precinct, and allocate block-level counts proportionally to those intersection weights. Summing the allocated counts across intersections yields precinct-level demographic totals.</span>
<span id="cb139-85"><a href="#cb139-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-86"><a href="#cb139-86" aria-hidden="true" tabindex="-1"></a>Formally, let $b$ index census blocks and $p$ index precincts. Define the intersection area $A_{bp} = \text{area}(b \cap p)$ and block area $A_b = \text{area}(b)$. The areal weight is:</span>
<span id="cb139-87"><a href="#cb139-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-88"><a href="#cb139-88" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-89"><a href="#cb139-89" aria-hidden="true" tabindex="-1"></a>w_{bp} = \frac{A_{bp}}{A_b}</span>
<span id="cb139-90"><a href="#cb139-90" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-91"><a href="#cb139-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-92"><a href="#cb139-92" aria-hidden="true" tabindex="-1"></a>For a block-level count $X_b$ (e.g., total population, race counts), the precinct-allocated contribution from block $b$ is:</span>
<span id="cb139-93"><a href="#cb139-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-94"><a href="#cb139-94" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-95"><a href="#cb139-95" aria-hidden="true" tabindex="-1"></a>X_{bp}^{\text{alloc}} = w_{bp} X_b</span>
<span id="cb139-96"><a href="#cb139-96" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-97"><a href="#cb139-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-98"><a href="#cb139-98" aria-hidden="true" tabindex="-1"></a>and the precinct-level total is:</span>
<span id="cb139-99"><a href="#cb139-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-100"><a href="#cb139-100" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-101"><a href="#cb139-101" aria-hidden="true" tabindex="-1"></a>X_p = \sum_{b} X_{bp}^{\text{alloc}}</span>
<span id="cb139-102"><a href="#cb139-102" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-103"><a href="#cb139-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-104"><a href="#cb139-104" aria-hidden="true" tabindex="-1"></a>We then compute precinct demographic shares (e.g., percent Black) as:</span>
<span id="cb139-105"><a href="#cb139-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-106"><a href="#cb139-106" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-107"><a href="#cb139-107" aria-hidden="true" tabindex="-1"></a>\%Black_p = 100 \times \frac{Black_p}{TotalPop_p}</span>
<span id="cb139-108"><a href="#cb139-108" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-109"><a href="#cb139-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-110"><a href="#cb139-110" aria-hidden="true" tabindex="-1"></a>with analogous definitions for percent Hispanic and percent White.</span>
<span id="cb139-111"><a href="#cb139-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-112"><a href="#cb139-112" aria-hidden="true" tabindex="-1"></a>This approach implicitly assumes uniform population density within each block. While imperfect, it is standard practice when translating census counts to non-nested administrative boundaries, and it produces internally consistent precinct-level denominators for per-capita crime rate computation.</span>
<span id="cb139-113"><a href="#cb139-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-114"><a href="#cb139-114" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2020 Census Data Processing</span></span>
<span id="cb139-115"><a href="#cb139-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-116"><a href="#cb139-116" aria-hidden="true" tabindex="-1"></a>We load the 2020 census block geometries from a local shapefile and filter to the five NYC counties (Bronx, Kings, New York, Queens, Richmond). We then use <span class="in">`tidycensus`</span> to pull race and ethnicity counts from the 2020 Decennial Census P1 (race) and P2 (Hispanic origin) tables. These block-level counts will be spatially interpolated to precinct boundaries.</span>
<span id="cb139-117"><a href="#cb139-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-120"><a href="#cb139-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-121"><a href="#cb139-121" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-2020-blocks</span></span>
<span id="cb139-122"><a href="#cb139-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-123"><a href="#cb139-123" aria-hidden="true" tabindex="-1"></a>blocks_2020 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"../data/tl_2020_36_tabblock20/tl_2020_36_tabblock20.shp"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb139-124"><a href="#cb139-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-125"><a href="#cb139-125" aria-hidden="true" tabindex="-1"></a>nyc_counties <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"005"</span>, <span class="st">"047"</span>, <span class="st">"061"</span>, <span class="st">"081"</span>, <span class="st">"085"</span>)</span>
<span id="cb139-126"><a href="#cb139-126" aria-hidden="true" tabindex="-1"></a>blocks_2020_nyc <span class="ot">&lt;-</span> blocks_2020 <span class="sc">%&gt;%</span></span>
<span id="cb139-127"><a href="#cb139-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNTYFP20 <span class="sc">%in%</span> nyc_counties)</span>
<span id="cb139-128"><a href="#cb139-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-129"><a href="#cb139-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-130"><a href="#cb139-130" aria-hidden="true" tabindex="-1"></a>We pull 2020 race data (P1 table: total population and race alone categories) and Hispanic origin data (P2 table) from the Census API. The "wide" output format gives us one column per variable, which simplifies the subsequent join and allocation steps.</span>
<span id="cb139-131"><a href="#cb139-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-134"><a href="#cb139-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-135"><a href="#cb139-135" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pull-2020-census-data</span></span>
<span id="cb139-136"><a href="#cb139-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-137"><a href="#cb139-137" aria-hidden="true" tabindex="-1"></a>p1_2020 <span class="ot">&lt;-</span> <span class="fu">get_decennial</span>(</span>
<span id="cb139-138"><a href="#cb139-138" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"block"</span>,</span>
<span id="cb139-139"><a href="#cb139-139" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"P1_001N"</span>, <span class="st">"P1_003N"</span>, <span class="st">"P1_004N"</span>, <span class="st">"P1_005N"</span>, </span>
<span id="cb139-140"><a href="#cb139-140" aria-hidden="true" tabindex="-1"></a>                <span class="st">"P1_006N"</span>, <span class="st">"P1_007N"</span>, <span class="st">"P1_008N"</span>, <span class="st">"P1_009N"</span>),</span>
<span id="cb139-141"><a href="#cb139-141" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"NY"</span>,</span>
<span id="cb139-142"><a href="#cb139-142" aria-hidden="true" tabindex="-1"></a>  <span class="at">county =</span> nyc_counties,</span>
<span id="cb139-143"><a href="#cb139-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb139-144"><a href="#cb139-144" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"wide"</span></span>
<span id="cb139-145"><a href="#cb139-145" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-146"><a href="#cb139-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-147"><a href="#cb139-147" aria-hidden="true" tabindex="-1"></a>p2_2020 <span class="ot">&lt;-</span> <span class="fu">get_decennial</span>(</span>
<span id="cb139-148"><a href="#cb139-148" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"block"</span>,</span>
<span id="cb139-149"><a href="#cb139-149" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"P2_001N"</span>, <span class="st">"P2_002N"</span>, <span class="st">"P2_003N"</span>),</span>
<span id="cb139-150"><a href="#cb139-150" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"NY"</span>,</span>
<span id="cb139-151"><a href="#cb139-151" aria-hidden="true" tabindex="-1"></a>  <span class="at">county =</span> nyc_counties,</span>
<span id="cb139-152"><a href="#cb139-152" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb139-153"><a href="#cb139-153" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"wide"</span></span>
<span id="cb139-154"><a href="#cb139-154" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-155"><a href="#cb139-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-156"><a href="#cb139-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-157"><a href="#cb139-157" aria-hidden="true" tabindex="-1"></a>We join the census demographic data to the block geometries, project to the same coordinate system as our precincts, and compute the area of each block. Then we intersect blocks with precincts to create polygon fragments, calculate what proportion of each block's area falls within each precinct (the areal weight), and allocate population counts proportionally. Finally, we aggregate these allocated counts by precinct to get precinct-level demographic totals.</span>
<span id="cb139-158"><a href="#cb139-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-161"><a href="#cb139-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-162"><a href="#cb139-162" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: interpolate-2020-to-precincts</span></span>
<span id="cb139-163"><a href="#cb139-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-164"><a href="#cb139-164" aria-hidden="true" tabindex="-1"></a>p1_2020 <span class="ot">&lt;-</span> p1_2020 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">GEOID20 =</span> GEOID)</span>
<span id="cb139-165"><a href="#cb139-165" aria-hidden="true" tabindex="-1"></a>p2_2020 <span class="ot">&lt;-</span> p2_2020 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">GEOID20 =</span> GEOID)</span>
<span id="cb139-166"><a href="#cb139-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-167"><a href="#cb139-167" aria-hidden="true" tabindex="-1"></a>blocks_demo_2020 <span class="ot">&lt;-</span> blocks_2020_nyc <span class="sc">%&gt;%</span></span>
<span id="cb139-168"><a href="#cb139-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(p1_2020, <span class="at">by =</span> <span class="st">"GEOID20"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-169"><a href="#cb139-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(p2_2020, <span class="at">by =</span> <span class="st">"GEOID20"</span>)</span>
<span id="cb139-170"><a href="#cb139-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-171"><a href="#cb139-171" aria-hidden="true" tabindex="-1"></a>blocks_2020_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(blocks_demo_2020, <span class="dv">32118</span>)</span>
<span id="cb139-172"><a href="#cb139-172" aria-hidden="true" tabindex="-1"></a>blocks_2020_proj <span class="ot">&lt;-</span> blocks_2020_proj <span class="sc">%&gt;%</span></span>
<span id="cb139-173"><a href="#cb139-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block_area =</span> <span class="fu">st_area</span>(geometry))</span>
<span id="cb139-174"><a href="#cb139-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-175"><a href="#cb139-175" aria-hidden="true" tabindex="-1"></a>block_precinct_int_2020 <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(blocks_2020_proj, precincts_proj)</span>
<span id="cb139-176"><a href="#cb139-176" aria-hidden="true" tabindex="-1"></a>block_precinct_int_2020 <span class="ot">&lt;-</span> block_precinct_int_2020 <span class="sc">%&gt;%</span></span>
<span id="cb139-177"><a href="#cb139-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb139-178"><a href="#cb139-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">piece_area =</span> <span class="fu">st_area</span>(geometry),</span>
<span id="cb139-179"><a href="#cb139-179" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> <span class="fu">as.numeric</span>(piece_area <span class="sc">/</span> block_area)</span>
<span id="cb139-180"><a href="#cb139-180" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-181"><a href="#cb139-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-182"><a href="#cb139-182" aria-hidden="true" tabindex="-1"></a>demo_vars_2020 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"P1_001N"</span>, <span class="st">"P1_003N"</span>, <span class="st">"P1_004N"</span>, <span class="st">"P1_005N"</span>,</span>
<span id="cb139-183"><a href="#cb139-183" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"P1_006N"</span>, <span class="st">"P1_007N"</span>, <span class="st">"P1_008N"</span>, <span class="st">"P1_009N"</span>,</span>
<span id="cb139-184"><a href="#cb139-184" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"P2_001N"</span>, <span class="st">"P2_002N"</span>, <span class="st">"P2_003N"</span>)</span>
<span id="cb139-185"><a href="#cb139-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-186"><a href="#cb139-186" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> demo_vars_2020) {</span>
<span id="cb139-187"><a href="#cb139-187" aria-hidden="true" tabindex="-1"></a>  block_precinct_int_2020[[<span class="fu">paste0</span>(v, <span class="st">"_alloc"</span>)]] <span class="ot">&lt;-</span></span>
<span id="cb139-188"><a href="#cb139-188" aria-hidden="true" tabindex="-1"></a>    block_precinct_int_2020[[v]] <span class="sc">*</span> block_precinct_int_2020<span class="sc">$</span>weight</span>
<span id="cb139-189"><a href="#cb139-189" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-190"><a href="#cb139-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-191"><a href="#cb139-191" aria-hidden="true" tabindex="-1"></a>precinct_demographics_2020 <span class="ot">&lt;-</span> block_precinct_int_2020 <span class="sc">%&gt;%</span></span>
<span id="cb139-192"><a href="#cb139-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-193"><a href="#cb139-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(precinct) <span class="sc">%&gt;%</span></span>
<span id="cb139-194"><a href="#cb139-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">ends_with</span>(<span class="st">"_alloc"</span>), sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb139-195"><a href="#cb139-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-196"><a href="#cb139-196" aria-hidden="true" tabindex="-1"></a>precincts_2020 <span class="ot">&lt;-</span> precincts_proj <span class="sc">%&gt;%</span></span>
<span id="cb139-197"><a href="#cb139-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(precinct_demographics_2020, <span class="at">by =</span> <span class="st">"precinct"</span>)</span>
<span id="cb139-198"><a href="#cb139-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-199"><a href="#cb139-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-200"><a href="#cb139-200" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2010 Census Data Processing</span></span>
<span id="cb139-201"><a href="#cb139-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-202"><a href="#cb139-202" aria-hidden="true" tabindex="-1"></a>We repeat the same areal interpolation process for 2010 Census data. We use <span class="in">`tigris::blocks()`</span> to download 2010 block geometries directly from the Census. The 2010 Decennial Census uses different table names (P003 for race, P004 for Hispanic origin), so we adjust our variable requests accordingly.</span>
<span id="cb139-203"><a href="#cb139-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-206"><a href="#cb139-206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-207"><a href="#cb139-207" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-2010-blocks</span></span>
<span id="cb139-208"><a href="#cb139-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-209"><a href="#cb139-209" aria-hidden="true" tabindex="-1"></a>blocks_2010 <span class="ot">&lt;-</span> <span class="fu">blocks</span>(<span class="at">state =</span> <span class="st">"NY"</span>, <span class="at">county =</span> nyc_counties, <span class="at">year =</span> <span class="dv">2010</span>)</span>
<span id="cb139-210"><a href="#cb139-210" aria-hidden="true" tabindex="-1"></a>blocks_2010_nyc <span class="ot">&lt;-</span> blocks_2010 <span class="sc">%&gt;%</span></span>
<span id="cb139-211"><a href="#cb139-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNTYFP10 <span class="sc">%in%</span> nyc_counties)</span>
<span id="cb139-212"><a href="#cb139-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-213"><a href="#cb139-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-214"><a href="#cb139-214" aria-hidden="true" tabindex="-1"></a>We pull 2010 race and Hispanic origin data from the Census API using the appropriate 2010 table codes.</span>
<span id="cb139-215"><a href="#cb139-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-218"><a href="#cb139-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-219"><a href="#cb139-219" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pull-2010-census-data</span></span>
<span id="cb139-220"><a href="#cb139-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-221"><a href="#cb139-221" aria-hidden="true" tabindex="-1"></a>p1_2010 <span class="ot">&lt;-</span> <span class="fu">get_decennial</span>(</span>
<span id="cb139-222"><a href="#cb139-222" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"block"</span>,</span>
<span id="cb139-223"><a href="#cb139-223" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"P003001"</span>, <span class="st">"P003002"</span>, <span class="st">"P003003"</span>, <span class="st">"P003004"</span>,</span>
<span id="cb139-224"><a href="#cb139-224" aria-hidden="true" tabindex="-1"></a>                <span class="st">"P003005"</span>, <span class="st">"P003006"</span>, <span class="st">"P003007"</span>, <span class="st">"P003008"</span>),</span>
<span id="cb139-225"><a href="#cb139-225" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"NY"</span>,</span>
<span id="cb139-226"><a href="#cb139-226" aria-hidden="true" tabindex="-1"></a>  <span class="at">county =</span> nyc_counties,</span>
<span id="cb139-227"><a href="#cb139-227" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2010</span>,</span>
<span id="cb139-228"><a href="#cb139-228" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"wide"</span></span>
<span id="cb139-229"><a href="#cb139-229" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-230"><a href="#cb139-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-231"><a href="#cb139-231" aria-hidden="true" tabindex="-1"></a>p2_2010 <span class="ot">&lt;-</span> <span class="fu">get_decennial</span>(</span>
<span id="cb139-232"><a href="#cb139-232" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"block"</span>,</span>
<span id="cb139-233"><a href="#cb139-233" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"P004001"</span>, <span class="st">"P004002"</span>, <span class="st">"P004003"</span>),</span>
<span id="cb139-234"><a href="#cb139-234" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"NY"</span>,</span>
<span id="cb139-235"><a href="#cb139-235" aria-hidden="true" tabindex="-1"></a>  <span class="at">county =</span> nyc_counties,</span>
<span id="cb139-236"><a href="#cb139-236" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2010</span>,</span>
<span id="cb139-237"><a href="#cb139-237" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"wide"</span></span>
<span id="cb139-238"><a href="#cb139-238" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-239"><a href="#cb139-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-240"><a href="#cb139-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-241"><a href="#cb139-241" aria-hidden="true" tabindex="-1"></a>We perform the same spatial interpolation workflow for 2010: join demographics to block geometries, project, intersect with precincts, compute areal weights, allocate counts proportionally, and aggregate to precinct totals.</span>
<span id="cb139-242"><a href="#cb139-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-245"><a href="#cb139-245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-246"><a href="#cb139-246" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: interpolate-2010-to-precincts</span></span>
<span id="cb139-247"><a href="#cb139-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-248"><a href="#cb139-248" aria-hidden="true" tabindex="-1"></a>p1_2010 <span class="ot">&lt;-</span> p1_2010 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">GEOID10 =</span> GEOID)</span>
<span id="cb139-249"><a href="#cb139-249" aria-hidden="true" tabindex="-1"></a>p2_2010 <span class="ot">&lt;-</span> p2_2010 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">GEOID10 =</span> GEOID)</span>
<span id="cb139-250"><a href="#cb139-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-251"><a href="#cb139-251" aria-hidden="true" tabindex="-1"></a>blocks_demo_2010 <span class="ot">&lt;-</span> blocks_2010_nyc <span class="sc">%&gt;%</span></span>
<span id="cb139-252"><a href="#cb139-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(p1_2010, <span class="at">by =</span> <span class="st">"GEOID10"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-253"><a href="#cb139-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(p2_2010, <span class="at">by =</span> <span class="st">"GEOID10"</span>)</span>
<span id="cb139-254"><a href="#cb139-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-255"><a href="#cb139-255" aria-hidden="true" tabindex="-1"></a>blocks_2010_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(blocks_demo_2010, <span class="dv">32118</span>)</span>
<span id="cb139-256"><a href="#cb139-256" aria-hidden="true" tabindex="-1"></a>blocks_2010_proj <span class="ot">&lt;-</span> blocks_2010_proj <span class="sc">%&gt;%</span></span>
<span id="cb139-257"><a href="#cb139-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block_area =</span> <span class="fu">st_area</span>(geometry))</span>
<span id="cb139-258"><a href="#cb139-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-259"><a href="#cb139-259" aria-hidden="true" tabindex="-1"></a>block_precinct_int_2010 <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(blocks_2010_proj, precincts_proj)</span>
<span id="cb139-260"><a href="#cb139-260" aria-hidden="true" tabindex="-1"></a>block_precinct_int_2010 <span class="ot">&lt;-</span> block_precinct_int_2010 <span class="sc">%&gt;%</span></span>
<span id="cb139-261"><a href="#cb139-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb139-262"><a href="#cb139-262" aria-hidden="true" tabindex="-1"></a>    <span class="at">piece_area =</span> <span class="fu">st_area</span>(geometry),</span>
<span id="cb139-263"><a href="#cb139-263" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> <span class="fu">as.numeric</span>(piece_area <span class="sc">/</span> block_area)</span>
<span id="cb139-264"><a href="#cb139-264" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-265"><a href="#cb139-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-266"><a href="#cb139-266" aria-hidden="true" tabindex="-1"></a>demo_vars_2010 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"P003001"</span>, <span class="st">"P003002"</span>, <span class="st">"P003003"</span>, <span class="st">"P003004"</span>,</span>
<span id="cb139-267"><a href="#cb139-267" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"P003005"</span>, <span class="st">"P003006"</span>, <span class="st">"P003007"</span>, <span class="st">"P003008"</span>,</span>
<span id="cb139-268"><a href="#cb139-268" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"P004001"</span>, <span class="st">"P004002"</span>, <span class="st">"P004003"</span>)</span>
<span id="cb139-269"><a href="#cb139-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-270"><a href="#cb139-270" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> demo_vars_2010) {</span>
<span id="cb139-271"><a href="#cb139-271" aria-hidden="true" tabindex="-1"></a>  block_precinct_int_2010[[<span class="fu">paste0</span>(v, <span class="st">"_alloc"</span>)]] <span class="ot">&lt;-</span></span>
<span id="cb139-272"><a href="#cb139-272" aria-hidden="true" tabindex="-1"></a>    block_precinct_int_2010[[v]] <span class="sc">*</span> block_precinct_int_2010<span class="sc">$</span>weight</span>
<span id="cb139-273"><a href="#cb139-273" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-274"><a href="#cb139-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-275"><a href="#cb139-275" aria-hidden="true" tabindex="-1"></a>precinct_demographics_2010 <span class="ot">&lt;-</span> block_precinct_int_2010 <span class="sc">%&gt;%</span></span>
<span id="cb139-276"><a href="#cb139-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-277"><a href="#cb139-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(precinct) <span class="sc">%&gt;%</span></span>
<span id="cb139-278"><a href="#cb139-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">ends_with</span>(<span class="st">"_alloc"</span>), sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb139-279"><a href="#cb139-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-280"><a href="#cb139-280" aria-hidden="true" tabindex="-1"></a>precincts_2010 <span class="ot">&lt;-</span> precincts_proj <span class="sc">%&gt;%</span></span>
<span id="cb139-281"><a href="#cb139-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(precinct_demographics_2010, <span class="at">by =</span> <span class="st">"precinct"</span>)</span>
<span id="cb139-282"><a href="#cb139-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-283"><a href="#cb139-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-284"><a href="#cb139-284" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Standardize Column Names</span></span>
<span id="cb139-285"><a href="#cb139-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-286"><a href="#cb139-286" aria-hidden="true" tabindex="-1"></a>The 2010 and 2020 Census use different variable naming conventions. We rename all demographic columns to consistent, human-readable names (e.g., <span class="in">`black_alloc`</span>, <span class="in">`white_alloc`</span>, <span class="in">`hispanic_alloc`</span>) so that downstream code can reference the same column names regardless of which census year the data comes from.</span>
<span id="cb139-287"><a href="#cb139-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-290"><a href="#cb139-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-291"><a href="#cb139-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: standardize-columns</span></span>
<span id="cb139-292"><a href="#cb139-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-293"><a href="#cb139-293" aria-hidden="true" tabindex="-1"></a>precincts_2010 <span class="ot">&lt;-</span> precincts_2010 <span class="sc">%&gt;%</span></span>
<span id="cb139-294"><a href="#cb139-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb139-295"><a href="#cb139-295" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop_alloc =</span> P003001_alloc,</span>
<span id="cb139-296"><a href="#cb139-296" aria-hidden="true" tabindex="-1"></a>    <span class="at">white_alloc =</span> P003002_alloc,</span>
<span id="cb139-297"><a href="#cb139-297" aria-hidden="true" tabindex="-1"></a>    <span class="at">black_alloc =</span> P003003_alloc,</span>
<span id="cb139-298"><a href="#cb139-298" aria-hidden="true" tabindex="-1"></a>    <span class="at">aian_alloc =</span> P003004_alloc,</span>
<span id="cb139-299"><a href="#cb139-299" aria-hidden="true" tabindex="-1"></a>    <span class="at">asian_alloc =</span> P003005_alloc,</span>
<span id="cb139-300"><a href="#cb139-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">nhpi_alloc =</span> P003006_alloc,</span>
<span id="cb139-301"><a href="#cb139-301" aria-hidden="true" tabindex="-1"></a>    <span class="at">other_alloc =</span> P003007_alloc,</span>
<span id="cb139-302"><a href="#cb139-302" aria-hidden="true" tabindex="-1"></a>    <span class="at">two_or_more_alloc =</span> P003008_alloc,</span>
<span id="cb139-303"><a href="#cb139-303" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_total_alloc =</span> P004001_alloc,</span>
<span id="cb139-304"><a href="#cb139-304" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_alloc =</span> P004002_alloc,</span>
<span id="cb139-305"><a href="#cb139-305" aria-hidden="true" tabindex="-1"></a>    <span class="at">not_hispanic_alloc =</span> P004003_alloc</span>
<span id="cb139-306"><a href="#cb139-306" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-307"><a href="#cb139-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-308"><a href="#cb139-308" aria-hidden="true" tabindex="-1"></a>precincts_2020 <span class="ot">&lt;-</span> precincts_2020 <span class="sc">%&gt;%</span></span>
<span id="cb139-309"><a href="#cb139-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb139-310"><a href="#cb139-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop_alloc =</span> P1_001N_alloc,</span>
<span id="cb139-311"><a href="#cb139-311" aria-hidden="true" tabindex="-1"></a>    <span class="at">white_alloc =</span> P1_003N_alloc,</span>
<span id="cb139-312"><a href="#cb139-312" aria-hidden="true" tabindex="-1"></a>    <span class="at">black_alloc =</span> P1_004N_alloc,</span>
<span id="cb139-313"><a href="#cb139-313" aria-hidden="true" tabindex="-1"></a>    <span class="at">aian_alloc =</span> P1_005N_alloc,</span>
<span id="cb139-314"><a href="#cb139-314" aria-hidden="true" tabindex="-1"></a>    <span class="at">asian_alloc =</span> P1_006N_alloc,</span>
<span id="cb139-315"><a href="#cb139-315" aria-hidden="true" tabindex="-1"></a>    <span class="at">nhpi_alloc =</span> P1_007N_alloc,</span>
<span id="cb139-316"><a href="#cb139-316" aria-hidden="true" tabindex="-1"></a>    <span class="at">other_alloc =</span> P1_008N_alloc,</span>
<span id="cb139-317"><a href="#cb139-317" aria-hidden="true" tabindex="-1"></a>    <span class="at">two_or_more_alloc =</span> P1_009N_alloc,</span>
<span id="cb139-318"><a href="#cb139-318" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_total_alloc =</span> P2_001N_alloc,</span>
<span id="cb139-319"><a href="#cb139-319" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_alloc =</span> P2_002N_alloc,</span>
<span id="cb139-320"><a href="#cb139-320" aria-hidden="true" tabindex="-1"></a>    <span class="at">not_hispanic_alloc =</span> P2_003N_alloc</span>
<span id="cb139-321"><a href="#cb139-321" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-322"><a href="#cb139-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-323"><a href="#cb139-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-324"><a href="#cb139-324" aria-hidden="true" tabindex="-1"></a><span class="fu">### Crime Data: Violent Felony Complaint Records</span></span>
<span id="cb139-325"><a href="#cb139-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-326"><a href="#cb139-326" aria-hidden="true" tabindex="-1"></a>We load a cleaned violent felony complaint dataset from the city containing point locations (latitude/longitude) and complaint dates. Complaint points are converted into an <span class="in">`sf`</span> point object in WGS84 (EPSG:4326) and then filtered to a bounding box corresponding to New York City to remove obvious geocoding errors. Points are subsequently projected into EPSG:32118 for spatial joins and distance-consistent operations. Complaint dates are parsed to extract year, enabling period-based subsetting.</span>
<span id="cb139-327"><a href="#cb139-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-328"><a href="#cb139-328" aria-hidden="true" tabindex="-1"></a>We read the crime data CSV, convert it to a spatial points object using the longitude and latitude columns, filter out any points that fall outside NYC's bounding box (likely geocoding errors), project to our analysis CRS, and extract the year from each complaint date for temporal filtering.</span>
<span id="cb139-329"><a href="#cb139-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-332"><a href="#cb139-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-333"><a href="#cb139-333" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-crime-data</span></span>
<span id="cb139-334"><a href="#cb139-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-335"><a href="#cb139-335" aria-hidden="true" tabindex="-1"></a>violent_crimes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/violent_felony_cleaned_13.csv"</span>)</span>
<span id="cb139-336"><a href="#cb139-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-337"><a href="#cb139-337" aria-hidden="true" tabindex="-1"></a>violent_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(</span>
<span id="cb139-338"><a href="#cb139-338" aria-hidden="true" tabindex="-1"></a>  violent_crimes,</span>
<span id="cb139-339"><a href="#cb139-339" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>),</span>
<span id="cb139-340"><a href="#cb139-340" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="dv">4326</span></span>
<span id="cb139-341"><a href="#cb139-341" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-342"><a href="#cb139-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-343"><a href="#cb139-343" aria-hidden="true" tabindex="-1"></a>violent_sf <span class="ot">&lt;-</span> violent_sf <span class="sc">%&gt;%</span></span>
<span id="cb139-344"><a href="#cb139-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb139-345"><a href="#cb139-345" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(geometry),</span>
<span id="cb139-346"><a href="#cb139-346" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>] <span class="sc">&gt;</span> <span class="sc">-</span><span class="fl">74.5</span>,</span>
<span id="cb139-347"><a href="#cb139-347" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>] <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">73.7</span>,</span>
<span id="cb139-348"><a href="#cb139-348" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>] <span class="sc">&gt;</span> <span class="fl">40.45</span>,</span>
<span id="cb139-349"><a href="#cb139-349" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>] <span class="sc">&lt;</span> <span class="fl">40.95</span></span>
<span id="cb139-350"><a href="#cb139-350" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-351"><a href="#cb139-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-352"><a href="#cb139-352" aria-hidden="true" tabindex="-1"></a>violent_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(violent_sf, <span class="dv">32118</span>)</span>
<span id="cb139-353"><a href="#cb139-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-354"><a href="#cb139-354" aria-hidden="true" tabindex="-1"></a>violent_proj <span class="ot">&lt;-</span> violent_proj <span class="sc">%&gt;%</span></span>
<span id="cb139-355"><a href="#cb139-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb139-356"><a href="#cb139-356" aria-hidden="true" tabindex="-1"></a>    <span class="at">complaint_date =</span> <span class="fu">as.Date</span>(complaint_date),</span>
<span id="cb139-357"><a href="#cb139-357" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(complaint_date, <span class="st">"%Y"</span>))</span>
<span id="cb139-358"><a href="#cb139-358" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-359"><a href="#cb139-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-360"><a href="#cb139-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-361"><a href="#cb139-361" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pre/Post Comparison Windows</span></span>
<span id="cb139-362"><a href="#cb139-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-363"><a href="#cb139-363" aria-hidden="true" tabindex="-1"></a>To reduce transitional ambiguity surrounding the implementation timeline, we define two non-overlapping windows:</span>
<span id="cb139-364"><a href="#cb139-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-365"><a href="#cb139-365" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Before**: 2010–2012</span>
<span id="cb139-366"><a href="#cb139-366" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**After**: 2013–2019</span>
<span id="cb139-367"><a href="#cb139-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-368"><a href="#cb139-368" aria-hidden="true" tabindex="-1"></a>For each period, we spatially join complaint points to precinct polygons, count incidents per precinct, and compute the precinct-level violent felony rate per 1,000 residents:</span>
<span id="cb139-369"><a href="#cb139-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-370"><a href="#cb139-370" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-371"><a href="#cb139-371" aria-hidden="true" tabindex="-1"></a>CrimeRate_p = 1000 \times \frac{Crimes_p}{TotalPop_p}</span>
<span id="cb139-372"><a href="#cb139-372" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-373"><a href="#cb139-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-374"><a href="#cb139-374" aria-hidden="true" tabindex="-1"></a>We exclude precinct 22 (Central Park) due to its negligible residential population, which otherwise induces artificially inflated per-capita rates and undermines interpretability.</span>
<span id="cb139-375"><a href="#cb139-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-376"><a href="#cb139-376" aria-hidden="true" tabindex="-1"></a>We split the crime data into pre-Patternizr (2010-2012) and post-Patternizr (2013-2019) periods. For each period, we spatially join crime points to precincts to determine which precinct each crime falls within, then count crimes per precinct and compute per-capita crime rates. We also calculate demographic percentages (percent Black, Hispanic, White) for use in regression analyses.</span>
<span id="cb139-377"><a href="#cb139-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-380"><a href="#cb139-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-381"><a href="#cb139-381" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: create-before-after-datasets</span></span>
<span id="cb139-382"><a href="#cb139-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-383"><a href="#cb139-383" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter crimes by period</span></span>
<span id="cb139-384"><a href="#cb139-384" aria-hidden="true" tabindex="-1"></a>crimes_before <span class="ot">&lt;-</span> violent_proj <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2012</span>)</span>
<span id="cb139-385"><a href="#cb139-385" aria-hidden="true" tabindex="-1"></a>crimes_after <span class="ot">&lt;-</span> violent_proj <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2013</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2019</span>)</span>
<span id="cb139-386"><a href="#cb139-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-387"><a href="#cb139-387" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Crimes before (2010-2012):"</span>, <span class="fu">nrow</span>(crimes_before), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb139-388"><a href="#cb139-388" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Crimes after (2013-2019):"</span>, <span class="fu">nrow</span>(crimes_after), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb139-389"><a href="#cb139-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-390"><a href="#cb139-390" aria-hidden="true" tabindex="-1"></a><span class="co"># Count crimes per precinct - BEFORE</span></span>
<span id="cb139-391"><a href="#cb139-391" aria-hidden="true" tabindex="-1"></a>crime_counts_before <span class="ot">&lt;-</span> crimes_before <span class="sc">%&gt;%</span></span>
<span id="cb139-392"><a href="#cb139-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(precincts_proj, <span class="at">join =</span> st_within) <span class="sc">%&gt;%</span></span>
<span id="cb139-393"><a href="#cb139-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-394"><a href="#cb139-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(precinct) <span class="sc">%&gt;%</span></span>
<span id="cb139-395"><a href="#cb139-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_crimes =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb139-396"><a href="#cb139-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-397"><a href="#cb139-397" aria-hidden="true" tabindex="-1"></a>precincts_before <span class="ot">&lt;-</span> precincts_2010 <span class="sc">%&gt;%</span></span>
<span id="cb139-398"><a href="#cb139-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(crime_counts_before, <span class="at">by =</span> <span class="st">"precinct"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-399"><a href="#cb139-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb139-400"><a href="#cb139-400" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_crimes =</span> <span class="fu">replace_na</span>(total_crimes, <span class="dv">0</span>),</span>
<span id="cb139-401"><a href="#cb139-401" aria-hidden="true" tabindex="-1"></a>    <span class="at">crime_rate =</span> (total_crimes <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb139-402"><a href="#cb139-402" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_black =</span> (black_alloc <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb139-403"><a href="#cb139-403" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_hispanic =</span> (hispanic_alloc <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb139-404"><a href="#cb139-404" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_white =</span> (white_alloc <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb139-405"><a href="#cb139-405" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-406"><a href="#cb139-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-407"><a href="#cb139-407" aria-hidden="true" tabindex="-1"></a><span class="co"># Count crimes per precinct - AFTER</span></span>
<span id="cb139-408"><a href="#cb139-408" aria-hidden="true" tabindex="-1"></a>crime_counts_after <span class="ot">&lt;-</span> crimes_after <span class="sc">%&gt;%</span></span>
<span id="cb139-409"><a href="#cb139-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(precincts_proj, <span class="at">join =</span> st_within) <span class="sc">%&gt;%</span></span>
<span id="cb139-410"><a href="#cb139-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-411"><a href="#cb139-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(precinct) <span class="sc">%&gt;%</span></span>
<span id="cb139-412"><a href="#cb139-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_crimes =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb139-413"><a href="#cb139-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-414"><a href="#cb139-414" aria-hidden="true" tabindex="-1"></a>precincts_after <span class="ot">&lt;-</span> precincts_2020 <span class="sc">%&gt;%</span></span>
<span id="cb139-415"><a href="#cb139-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(crime_counts_after, <span class="at">by =</span> <span class="st">"precinct"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-416"><a href="#cb139-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb139-417"><a href="#cb139-417" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_crimes =</span> <span class="fu">replace_na</span>(total_crimes, <span class="dv">0</span>),</span>
<span id="cb139-418"><a href="#cb139-418" aria-hidden="true" tabindex="-1"></a>    <span class="at">crime_rate =</span> (total_crimes <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb139-419"><a href="#cb139-419" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_black =</span> (black_alloc <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb139-420"><a href="#cb139-420" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_hispanic =</span> (hispanic_alloc <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb139-421"><a href="#cb139-421" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_white =</span> (white_alloc <span class="sc">/</span> total_pop_alloc) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb139-422"><a href="#cb139-422" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-423"><a href="#cb139-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-424"><a href="#cb139-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-425"><a href="#cb139-425" aria-hidden="true" tabindex="-1"></a>We remove Central Park (Precinct 22) from both datasets because its near-zero residential population produces undefined or extreme crime rates that would distort our analysis.</span>
<span id="cb139-426"><a href="#cb139-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-429"><a href="#cb139-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-430"><a href="#cb139-430" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: remove-central-park</span></span>
<span id="cb139-431"><a href="#cb139-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-432"><a href="#cb139-432" aria-hidden="true" tabindex="-1"></a>precincts_before <span class="ot">&lt;-</span> precincts_before <span class="sc">%&gt;%</span> <span class="fu">filter</span>(precinct <span class="sc">!=</span> <span class="st">"22"</span>)</span>
<span id="cb139-433"><a href="#cb139-433" aria-hidden="true" tabindex="-1"></a>precincts_after <span class="ot">&lt;-</span> precincts_after <span class="sc">%&gt;%</span> <span class="fu">filter</span>(precinct <span class="sc">!=</span> <span class="st">"22"</span>)</span>
<span id="cb139-434"><a href="#cb139-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-435"><a href="#cb139-435" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Precincts remaining (before):"</span>, <span class="fu">nrow</span>(precincts_before), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb139-436"><a href="#cb139-436" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Precincts remaining (after):"</span>, <span class="fu">nrow</span>(precincts_after), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb139-437"><a href="#cb139-437" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-438"><a href="#cb139-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-439"><a href="#cb139-439" aria-hidden="true" tabindex="-1"></a>We examine summary statistics for crime rates in both periods to verify our data processing produced reasonable values and to get a sense of the distribution before proceeding to spatial analysis.</span>
<span id="cb139-440"><a href="#cb139-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-443"><a href="#cb139-443" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-444"><a href="#cb139-444" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: summary-stats</span></span>
<span id="cb139-445"><a href="#cb139-445" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(precincts_before<span class="sc">$</span>crime_rate)</span>
<span id="cb139-446"><a href="#cb139-446" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(precincts_after<span class="sc">$</span>crime_rate)</span>
<span id="cb139-447"><a href="#cb139-447" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-448"><a href="#cb139-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-449"><a href="#cb139-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-450"><a href="#cb139-450" aria-hidden="true" tabindex="-1"></a><span class="al">![Crime rates per 1,000 residents across NYPD precincts before and after Patternizr](crime_rate_comparison.png)</span></span>
<span id="cb139-451"><a href="#cb139-451" aria-hidden="true" tabindex="-1"></a><span class="al">![Percent of population that is black across NYPD precincts before and after Patternizr](pct_black_comparison.png)</span></span>
<span id="cb139-452"><a href="#cb139-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-453"><a href="#cb139-453" aria-hidden="true" tabindex="-1"></a><span class="fu">## Methods</span></span>
<span id="cb139-454"><a href="#cb139-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-455"><a href="#cb139-455" aria-hidden="true" tabindex="-1"></a>Our empirical strategy combines (i) global measures of spatial autocorrelation, (ii) local cluster detection, (iii) a simulation-based null model to benchmark observed clustering, and (iv) a spatially varying regression diagnostic. These components correspond directly to the computational workflow implemented below.</span>
<span id="cb139-456"><a href="#cb139-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-457"><a href="#cb139-457" aria-hidden="true" tabindex="-1"></a><span class="fu">### Global Spatial Autocorrelation: Moran's I</span></span>
<span id="cb139-458"><a href="#cb139-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-459"><a href="#cb139-459" aria-hidden="true" tabindex="-1"></a>We quantify global spatial autocorrelation using Moran's $I$ for two variables: (a) precinct crime rates and (b) percent Black population. Spatial dependence is defined using a queen contiguity neighborhood structure (shared edges or corners). Let $x_p$ denote a precinct-level variable (e.g., crime rate) and $\bar{x}$ its mean. With spatial weights $w_{pq}$ (row-standardized), Moran's $I$ is:</span>
<span id="cb139-460"><a href="#cb139-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-461"><a href="#cb139-461" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-462"><a href="#cb139-462" aria-hidden="true" tabindex="-1"></a>I = \frac{n}{S_0}\frac{\sum_{p}\sum_{q} w_{pq}(x_p - \bar{x})(x_q - \bar{x})}{\sum_{p}(x_p - \bar{x})^2}</span>
<span id="cb139-463"><a href="#cb139-463" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-464"><a href="#cb139-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-465"><a href="#cb139-465" aria-hidden="true" tabindex="-1"></a>where $n$ is the number of precincts and $S_0 = \sum_{p}\sum_{q} w_{pq}$. We compute Moran's $I$ separately for each period and interpret differences as changes in the degree of clustering in the precinct-level surfaces.</span>
<span id="cb139-466"><a href="#cb139-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-467"><a href="#cb139-467" aria-hidden="true" tabindex="-1"></a>We construct spatial weights matrices based on queen contiguity (precincts that share an edge or corner are considered neighbors). The <span class="in">`spdep`</span> package requires sp objects, so we convert our sf objects and then build neighbor lists and row-standardized weights. Row standardization ensures that the weights for each precinct sum to 1.</span>
<span id="cb139-468"><a href="#cb139-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-471"><a href="#cb139-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-472"><a href="#cb139-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: create-spatial-weights</span></span>
<span id="cb139-473"><a href="#cb139-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-474"><a href="#cb139-474" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to sp objects for spdep</span></span>
<span id="cb139-475"><a href="#cb139-475" aria-hidden="true" tabindex="-1"></a>precincts_before_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(precincts_before, <span class="st">"Spatial"</span>)</span>
<span id="cb139-476"><a href="#cb139-476" aria-hidden="true" tabindex="-1"></a>precincts_after_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(precincts_after, <span class="st">"Spatial"</span>)</span>
<span id="cb139-477"><a href="#cb139-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-478"><a href="#cb139-478" aria-hidden="true" tabindex="-1"></a><span class="co"># Create queen contiguity neighbors (precincts sharing edges or corners)</span></span>
<span id="cb139-479"><a href="#cb139-479" aria-hidden="true" tabindex="-1"></a>nb_before <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(precincts_before_sp, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb139-480"><a href="#cb139-480" aria-hidden="true" tabindex="-1"></a>nb_after <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(precincts_after_sp, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb139-481"><a href="#cb139-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-482"><a href="#cb139-482" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to spatial weights (row-standardized)</span></span>
<span id="cb139-483"><a href="#cb139-483" aria-hidden="true" tabindex="-1"></a>weights_before <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb_before, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb139-484"><a href="#cb139-484" aria-hidden="true" tabindex="-1"></a>weights_after <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb_after, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb139-485"><a href="#cb139-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-486"><a href="#cb139-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-487"><a href="#cb139-487" aria-hidden="true" tabindex="-1"></a>We compute Global Moran's I for crime rates in both periods. A positive and significant Moran's I indicates that precincts with similar crime rates tend to be located near each other (positive spatial autocorrelation). We compare the values across periods to assess whether crime became more or less spatially clustered after Patternizr.</span>
<span id="cb139-488"><a href="#cb139-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-491"><a href="#cb139-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-492"><a href="#cb139-492" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: morans-i-crime-rate</span></span>
<span id="cb139-493"><a href="#cb139-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-494"><a href="#cb139-494" aria-hidden="true" tabindex="-1"></a><span class="co"># Before period</span></span>
<span id="cb139-495"><a href="#cb139-495" aria-hidden="true" tabindex="-1"></a>moran_crime_before <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(precincts_before<span class="sc">$</span>crime_rate, weights_before)</span>
<span id="cb139-496"><a href="#cb139-496" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_crime_before)</span>
<span id="cb139-497"><a href="#cb139-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-498"><a href="#cb139-498" aria-hidden="true" tabindex="-1"></a><span class="co"># After period</span></span>
<span id="cb139-499"><a href="#cb139-499" aria-hidden="true" tabindex="-1"></a>moran_crime_after <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(precincts_after<span class="sc">$</span>crime_rate, weights_after)</span>
<span id="cb139-500"><a href="#cb139-500" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_crime_after)</span>
<span id="cb139-501"><a href="#cb139-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-502"><a href="#cb139-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-503"><a href="#cb139-503" aria-hidden="true" tabindex="-1"></a>We also compute Global Moran's I for percent Black population to understand the spatial structure of racial composition. High values indicate strong residential segregation at the precinct scale. By comparing this to crime rate clustering, we can assess whether crime clusters align with demographic clusters.</span>
<span id="cb139-504"><a href="#cb139-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-507"><a href="#cb139-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-508"><a href="#cb139-508" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: morans-i-pct-black</span></span>
<span id="cb139-509"><a href="#cb139-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-510"><a href="#cb139-510" aria-hidden="true" tabindex="-1"></a><span class="co"># Before period</span></span>
<span id="cb139-511"><a href="#cb139-511" aria-hidden="true" tabindex="-1"></a>moran_black_before <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(precincts_before<span class="sc">$</span>pct_black, weights_before)</span>
<span id="cb139-512"><a href="#cb139-512" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_black_before)</span>
<span id="cb139-513"><a href="#cb139-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-514"><a href="#cb139-514" aria-hidden="true" tabindex="-1"></a><span class="co"># After period</span></span>
<span id="cb139-515"><a href="#cb139-515" aria-hidden="true" tabindex="-1"></a>moran_black_after <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(precincts_after<span class="sc">$</span>pct_black, weights_after)</span>
<span id="cb139-516"><a href="#cb139-516" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_black_after)</span>
<span id="cb139-517"><a href="#cb139-517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-518"><a href="#cb139-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-519"><a href="#cb139-519" aria-hidden="true" tabindex="-1"></a>We compile the Moran's I results into a summary table for easy comparison across variables and time periods.</span>
<span id="cb139-520"><a href="#cb139-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-523"><a href="#cb139-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-524"><a href="#cb139-524" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: morans-summary-table</span></span>
<span id="cb139-525"><a href="#cb139-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-526"><a href="#cb139-526" aria-hidden="true" tabindex="-1"></a>moran_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb139-527"><a href="#cb139-527" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">c</span>(<span class="st">"Crime Rate"</span>, <span class="st">"Crime Rate"</span>, <span class="st">"Pct Black"</span>, <span class="st">"Pct Black"</span>),</span>
<span id="cb139-528"><a href="#cb139-528" aria-hidden="true" tabindex="-1"></a>  <span class="at">Period =</span> <span class="fu">c</span>(<span class="st">"Before"</span>, <span class="st">"After"</span>, <span class="st">"Before"</span>, <span class="st">"After"</span>),</span>
<span id="cb139-529"><a href="#cb139-529" aria-hidden="true" tabindex="-1"></a>  <span class="at">Morans_I =</span> <span class="fu">c</span>(</span>
<span id="cb139-530"><a href="#cb139-530" aria-hidden="true" tabindex="-1"></a>    moran_crime_before<span class="sc">$</span>estimate[<span class="st">"Moran I statistic"</span>],</span>
<span id="cb139-531"><a href="#cb139-531" aria-hidden="true" tabindex="-1"></a>    moran_crime_after<span class="sc">$</span>estimate[<span class="st">"Moran I statistic"</span>],</span>
<span id="cb139-532"><a href="#cb139-532" aria-hidden="true" tabindex="-1"></a>    moran_black_before<span class="sc">$</span>estimate[<span class="st">"Moran I statistic"</span>],</span>
<span id="cb139-533"><a href="#cb139-533" aria-hidden="true" tabindex="-1"></a>    moran_black_after<span class="sc">$</span>estimate[<span class="st">"Moran I statistic"</span>]</span>
<span id="cb139-534"><a href="#cb139-534" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb139-535"><a href="#cb139-535" aria-hidden="true" tabindex="-1"></a>  <span class="at">P_Value =</span> <span class="fu">c</span>(</span>
<span id="cb139-536"><a href="#cb139-536" aria-hidden="true" tabindex="-1"></a>    moran_crime_before<span class="sc">$</span>p.value,</span>
<span id="cb139-537"><a href="#cb139-537" aria-hidden="true" tabindex="-1"></a>    moran_crime_after<span class="sc">$</span>p.value,</span>
<span id="cb139-538"><a href="#cb139-538" aria-hidden="true" tabindex="-1"></a>    moran_black_before<span class="sc">$</span>p.value,</span>
<span id="cb139-539"><a href="#cb139-539" aria-hidden="true" tabindex="-1"></a>    moran_black_after<span class="sc">$</span>p.value</span>
<span id="cb139-540"><a href="#cb139-540" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-541"><a href="#cb139-541" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-542"><a href="#cb139-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-543"><a href="#cb139-543" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_summary)</span>
<span id="cb139-544"><a href="#cb139-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-545"><a href="#cb139-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-546"><a href="#cb139-546" aria-hidden="true" tabindex="-1"></a><span class="fu">### Local Moran's I and LISA Cluster Typology</span></span>
<span id="cb139-547"><a href="#cb139-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-548"><a href="#cb139-548" aria-hidden="true" tabindex="-1"></a>To identify localized clusters and spatial outliers, we compute Local Moran's $I$ (LISA) for both crime rates and percent Black. We classify each precinct into one of five categories based on the sign of its standardized value and the sign of its spatial lag (neighbors' average), conditional on statistical significance:</span>
<span id="cb139-549"><a href="#cb139-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-550"><a href="#cb139-550" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>High–High (hot spot): high value surrounded by high values</span>
<span id="cb139-551"><a href="#cb139-551" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Low–Low (cold spot): low value surrounded by low values</span>
<span id="cb139-552"><a href="#cb139-552" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>High–Low: high outlier surrounded by low values</span>
<span id="cb139-553"><a href="#cb139-553" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Low–High: low outlier surrounded by high values</span>
<span id="cb139-554"><a href="#cb139-554" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Not significant</span>
<span id="cb139-555"><a href="#cb139-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-556"><a href="#cb139-556" aria-hidden="true" tabindex="-1"></a>The key substantive comparison is whether High–High crime precincts co-occur with High–High Black precincts, and whether the count (and identity) of overlapping precincts changes from the pre-period to the post-period.</span>
<span id="cb139-557"><a href="#cb139-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-558"><a href="#cb139-558" aria-hidden="true" tabindex="-1"></a>We compute Local Moran's I (LISA) statistics for both crime rate and percent Black in each period. Then we classify each precinct into cluster categories based on whether the precinct's value and its neighbors' average are both high (High-High), both low (Low-Low), or mismatched (High-Low, Low-High), conditional on statistical significance at p &lt; 0.05.</span>
<span id="cb139-559"><a href="#cb139-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-562"><a href="#cb139-562" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-563"><a href="#cb139-563" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lisa-analysis</span></span>
<span id="cb139-564"><a href="#cb139-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-565"><a href="#cb139-565" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Local Moran's I</span></span>
<span id="cb139-566"><a href="#cb139-566" aria-hidden="true" tabindex="-1"></a>lisa_crime_before <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(precincts_before<span class="sc">$</span>crime_rate, weights_before)</span>
<span id="cb139-567"><a href="#cb139-567" aria-hidden="true" tabindex="-1"></a>lisa_black_before <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(precincts_before<span class="sc">$</span>pct_black, weights_before)</span>
<span id="cb139-568"><a href="#cb139-568" aria-hidden="true" tabindex="-1"></a>lisa_crime_after <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(precincts_after<span class="sc">$</span>crime_rate, weights_after)</span>
<span id="cb139-569"><a href="#cb139-569" aria-hidden="true" tabindex="-1"></a>lisa_black_after <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(precincts_after<span class="sc">$</span>pct_black, weights_after)</span>
<span id="cb139-570"><a href="#cb139-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-571"><a href="#cb139-571" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to classify LISA clusters</span></span>
<span id="cb139-572"><a href="#cb139-572" aria-hidden="true" tabindex="-1"></a>get_lisa_clusters <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, lisa_output, weights) {</span>
<span id="cb139-573"><a href="#cb139-573" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">scale</span>(variable)[,<span class="dv">1</span>]</span>
<span id="cb139-574"><a href="#cb139-574" aria-hidden="true" tabindex="-1"></a>  lag_z <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(weights, z)</span>
<span id="cb139-575"><a href="#cb139-575" aria-hidden="true" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> lisa_output[, <span class="dv">5</span>]</span>
<span id="cb139-576"><a href="#cb139-576" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-577"><a href="#cb139-577" aria-hidden="true" tabindex="-1"></a>  cluster <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb139-578"><a href="#cb139-578" aria-hidden="true" tabindex="-1"></a>    p_value <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Not Significant"</span>,</span>
<span id="cb139-579"><a href="#cb139-579" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_z <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-High"</span>,</span>
<span id="cb139-580"><a href="#cb139-580" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_z <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-Low"</span>,</span>
<span id="cb139-581"><a href="#cb139-581" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_z <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-Low"</span>,</span>
<span id="cb139-582"><a href="#cb139-582" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_z <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-High"</span>,</span>
<span id="cb139-583"><a href="#cb139-583" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Not Significant"</span></span>
<span id="cb139-584"><a href="#cb139-584" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-585"><a href="#cb139-585" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-586"><a href="#cb139-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cluster)</span>
<span id="cb139-587"><a href="#cb139-587" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-588"><a href="#cb139-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-589"><a href="#cb139-589" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to all four combinations</span></span>
<span id="cb139-590"><a href="#cb139-590" aria-hidden="true" tabindex="-1"></a>precincts_before<span class="sc">$</span>lisa_crime <span class="ot">&lt;-</span> <span class="fu">get_lisa_clusters</span>(</span>
<span id="cb139-591"><a href="#cb139-591" aria-hidden="true" tabindex="-1"></a>  precincts_before<span class="sc">$</span>crime_rate, lisa_crime_before, weights_before</span>
<span id="cb139-592"><a href="#cb139-592" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-593"><a href="#cb139-593" aria-hidden="true" tabindex="-1"></a>precincts_before<span class="sc">$</span>lisa_black <span class="ot">&lt;-</span> <span class="fu">get_lisa_clusters</span>(</span>
<span id="cb139-594"><a href="#cb139-594" aria-hidden="true" tabindex="-1"></a>  precincts_before<span class="sc">$</span>pct_black, lisa_black_before, weights_before</span>
<span id="cb139-595"><a href="#cb139-595" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-596"><a href="#cb139-596" aria-hidden="true" tabindex="-1"></a>precincts_after<span class="sc">$</span>lisa_crime <span class="ot">&lt;-</span> <span class="fu">get_lisa_clusters</span>(</span>
<span id="cb139-597"><a href="#cb139-597" aria-hidden="true" tabindex="-1"></a>  precincts_after<span class="sc">$</span>crime_rate, lisa_crime_after, weights_after</span>
<span id="cb139-598"><a href="#cb139-598" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-599"><a href="#cb139-599" aria-hidden="true" tabindex="-1"></a>precincts_after<span class="sc">$</span>lisa_black <span class="ot">&lt;-</span> <span class="fu">get_lisa_clusters</span>(</span>
<span id="cb139-600"><a href="#cb139-600" aria-hidden="true" tabindex="-1"></a>  precincts_after<span class="sc">$</span>pct_black, lisa_black_after, weights_after</span>
<span id="cb139-601"><a href="#cb139-601" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-602"><a href="#cb139-602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-603"><a href="#cb139-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-604"><a href="#cb139-604" aria-hidden="true" tabindex="-1"></a>We tabulate the LISA cluster classifications to see how many precincts fall into each category for crime rate and percent Black, and how these counts changed between periods.</span>
<span id="cb139-605"><a href="#cb139-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-608"><a href="#cb139-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-609"><a href="#cb139-609" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lisa-summary</span></span>
<span id="cb139-610"><a href="#cb139-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-611"><a href="#cb139-611" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(precincts_before<span class="sc">$</span>lisa_crime))</span>
<span id="cb139-612"><a href="#cb139-612" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(precincts_after<span class="sc">$</span>lisa_crime))</span>
<span id="cb139-613"><a href="#cb139-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-614"><a href="#cb139-614" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(precincts_before<span class="sc">$</span>lisa_black))</span>
<span id="cb139-615"><a href="#cb139-615" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(precincts_after<span class="sc">$</span>lisa_black))</span>
<span id="cb139-616"><a href="#cb139-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-617"><a href="#cb139-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-618"><a href="#cb139-618" aria-hidden="true" tabindex="-1"></a>The key question for our analysis: which precincts are simultaneously hot spots for both crime and Black population? This overlap is central to claims about racially disparate policing. We identify precincts that are High-High for both variables and compare across periods.</span>
<span id="cb139-619"><a href="#cb139-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-622"><a href="#cb139-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-623"><a href="#cb139-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lisa-overlap</span></span>
<span id="cb139-624"><a href="#cb139-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-625"><a href="#cb139-625" aria-hidden="true" tabindex="-1"></a><span class="co"># Before period</span></span>
<span id="cb139-626"><a href="#cb139-626" aria-hidden="true" tabindex="-1"></a>overlap_before <span class="ot">&lt;-</span> precincts_before <span class="sc">%&gt;%</span></span>
<span id="cb139-627"><a href="#cb139-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-628"><a href="#cb139-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lisa_crime <span class="sc">==</span> <span class="st">"High-High"</span> <span class="sc">&amp;</span> lisa_black <span class="sc">==</span> <span class="st">"High-High"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-629"><a href="#cb139-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(precinct, crime_rate, pct_black)</span>
<span id="cb139-630"><a href="#cb139-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-631"><a href="#cb139-631" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(overlap_before)</span>
<span id="cb139-632"><a href="#cb139-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-633"><a href="#cb139-633" aria-hidden="true" tabindex="-1"></a><span class="co"># After period</span></span>
<span id="cb139-634"><a href="#cb139-634" aria-hidden="true" tabindex="-1"></a>overlap_after <span class="ot">&lt;-</span> precincts_after <span class="sc">%&gt;%</span></span>
<span id="cb139-635"><a href="#cb139-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-636"><a href="#cb139-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lisa_crime <span class="sc">==</span> <span class="st">"High-High"</span> <span class="sc">&amp;</span> lisa_black <span class="sc">==</span> <span class="st">"High-High"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-637"><a href="#cb139-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(precinct, crime_rate, pct_black)</span>
<span id="cb139-638"><a href="#cb139-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-639"><a href="#cb139-639" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(overlap_after)</span>
<span id="cb139-640"><a href="#cb139-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-641"><a href="#cb139-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-642"><a href="#cb139-642" aria-hidden="true" tabindex="-1"></a>We create a full cross-tabulation of crime clusters vs. Black population clusters to see the complete joint distribution, not just the High-High overlap.</span>
<span id="cb139-643"><a href="#cb139-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-646"><a href="#cb139-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-647"><a href="#cb139-647" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lisa-crosstab</span></span>
<span id="cb139-648"><a href="#cb139-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-649"><a href="#cb139-649" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(precincts_before<span class="sc">$</span>lisa_crime, precincts_before<span class="sc">$</span>lisa_black))</span>
<span id="cb139-650"><a href="#cb139-650" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(precincts_after<span class="sc">$</span>lisa_crime, precincts_after<span class="sc">$</span>lisa_black))</span>
<span id="cb139-651"><a href="#cb139-651" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-652"><a href="#cb139-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-653"><a href="#cb139-653" aria-hidden="true" tabindex="-1"></a>We track specific precincts (73, 77, 81) that were identified as High-High for both crime and Black population in the before period to understand what happened to them in the after period—did they remain hot spots, or did their classification change?</span>
<span id="cb139-654"><a href="#cb139-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-657"><a href="#cb139-657" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-658"><a href="#cb139-658" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: track-precincts</span></span>
<span id="cb139-659"><a href="#cb139-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-660"><a href="#cb139-660" aria-hidden="true" tabindex="-1"></a>track_precincts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"73"</span>, <span class="st">"77"</span>, <span class="st">"81"</span>)</span>
<span id="cb139-661"><a href="#cb139-661" aria-hidden="true" tabindex="-1"></a>precincts_before <span class="sc">%&gt;%</span></span>
<span id="cb139-662"><a href="#cb139-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-663"><a href="#cb139-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(precinct <span class="sc">%in%</span> track_precincts) <span class="sc">%&gt;%</span></span>
<span id="cb139-664"><a href="#cb139-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(precinct, total_crimes, crime_rate, pct_black, lisa_crime, lisa_black) <span class="sc">%&gt;%</span></span>
<span id="cb139-665"><a href="#cb139-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb139-666"><a href="#cb139-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-667"><a href="#cb139-667" aria-hidden="true" tabindex="-1"></a>precincts_after <span class="sc">%&gt;%</span></span>
<span id="cb139-668"><a href="#cb139-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-669"><a href="#cb139-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(precinct <span class="sc">%in%</span> track_precincts) <span class="sc">%&gt;%</span></span>
<span id="cb139-670"><a href="#cb139-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(precinct, total_crimes, crime_rate, pct_black, lisa_crime, lisa_black) <span class="sc">%&gt;%</span></span>
<span id="cb139-671"><a href="#cb139-671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb139-672"><a href="#cb139-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-673"><a href="#cb139-673" aria-hidden="true" tabindex="-1"></a>precincts_after <span class="sc">%&gt;%</span></span>
<span id="cb139-674"><a href="#cb139-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-675"><a href="#cb139-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lisa_crime <span class="sc">==</span> <span class="st">"High-High"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-676"><a href="#cb139-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(precinct, crime_rate, pct_black, lisa_black) <span class="sc">%&gt;%</span></span>
<span id="cb139-677"><a href="#cb139-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb139-678"><a href="#cb139-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-679"><a href="#cb139-679" aria-hidden="true" tabindex="-1"></a>precincts_after <span class="sc">%&gt;%</span></span>
<span id="cb139-680"><a href="#cb139-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-681"><a href="#cb139-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lisa_black <span class="sc">==</span> <span class="st">"High-High"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-682"><a href="#cb139-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(precinct, crime_rate, pct_black, lisa_crime) <span class="sc">%&gt;%</span></span>
<span id="cb139-683"><a href="#cb139-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb139-684"><a href="#cb139-684" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-685"><a href="#cb139-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-686"><a href="#cb139-686" aria-hidden="true" tabindex="-1"></a><span class="fu">### Monte Carlo Null Model for Crime Clustering</span></span>
<span id="cb139-687"><a href="#cb139-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-688"><a href="#cb139-688" aria-hidden="true" tabindex="-1"></a>Global Moran's $I$ can be statistically significant even under modest clustering when sample sizes are large; more importantly, observed clustering may reflect population distribution rather than any additional geographic process. We therefore implement a Monte Carlo simulation under a population-proportional null:</span>
<span id="cb139-689"><a href="#cb139-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-690"><a href="#cb139-690" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The total number of crimes observed in a period is held fixed.</span>
<span id="cb139-691"><a href="#cb139-691" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Crimes are randomly allocated to precincts with probability proportional to precinct population.</span>
<span id="cb139-692"><a href="#cb139-692" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Simulated crime rates are computed and Moran's $I$ is evaluated for each simulation.</span>
<span id="cb139-693"><a href="#cb139-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-694"><a href="#cb139-694" aria-hidden="true" tabindex="-1"></a>Let $C$ be the observed number of crimes in a period and $p_p = \frac{Pop_p}{\sum_q Pop_q}$. A single simulation draws precinct crime counts:</span>
<span id="cb139-695"><a href="#cb139-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-696"><a href="#cb139-696" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-697"><a href="#cb139-697" aria-hidden="true" tabindex="-1"></a>(C_1,\ldots,C_n) \sim \text{Multinomial}\left(C; p_1,\ldots,p_n\right)</span>
<span id="cb139-698"><a href="#cb139-698" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-699"><a href="#cb139-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-700"><a href="#cb139-700" aria-hidden="true" tabindex="-1"></a>and constructs simulated rates $CrimeRate_p^{(s)} = 1000 \times \frac{C_p}{Pop_p}$. Repeating this process yields an empirical null distribution of Moran's $I$. We compute the Monte Carlo p-value as the proportion of simulated Moran's $I$ values greater than or equal to the observed $I$ (with a standard +1 correction):</span>
<span id="cb139-701"><a href="#cb139-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-702"><a href="#cb139-702" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-703"><a href="#cb139-703" aria-hidden="true" tabindex="-1"></a>p = \frac{<span class="sc">\#\{</span>I^{(s)} \ge I^{obs}<span class="sc">\}</span> + 1}{S + 1}</span>
<span id="cb139-704"><a href="#cb139-704" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-705"><a href="#cb139-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-706"><a href="#cb139-706" aria-hidden="true" tabindex="-1"></a>where $S$ is the number of simulations.</span>
<span id="cb139-707"><a href="#cb139-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-708"><a href="#cb139-708" aria-hidden="true" tabindex="-1"></a>We define a function to run Monte Carlo simulations under the null hypothesis that crimes are distributed proportionally to population. For each simulation, we randomly allocate the observed total number of crimes to precincts using a multinomial distribution with probabilities equal to each precinct's share of total population, compute crime rates, and calculate Moran's I.</span>
<span id="cb139-709"><a href="#cb139-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-712"><a href="#cb139-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-713"><a href="#cb139-713" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: monte-carlo-function</span></span>
<span id="cb139-714"><a href="#cb139-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-715"><a href="#cb139-715" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">65</span>)</span>
<span id="cb139-716"><a href="#cb139-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-717"><a href="#cb139-717" aria-hidden="true" tabindex="-1"></a>simulate_morans_i <span class="ot">&lt;-</span> <span class="cf">function</span>(precincts_df, weights, <span class="at">n_sims =</span> <span class="dv">999</span>) {</span>
<span id="cb139-718"><a href="#cb139-718" aria-hidden="true" tabindex="-1"></a>  total_crimes <span class="ot">&lt;-</span> <span class="fu">sum</span>(precincts_df<span class="sc">$</span>total_crimes)</span>
<span id="cb139-719"><a href="#cb139-719" aria-hidden="true" tabindex="-1"></a>  populations <span class="ot">&lt;-</span> precincts_df<span class="sc">$</span>total_pop_alloc</span>
<span id="cb139-720"><a href="#cb139-720" aria-hidden="true" tabindex="-1"></a>  total_pop <span class="ot">&lt;-</span> <span class="fu">sum</span>(populations)</span>
<span id="cb139-721"><a href="#cb139-721" aria-hidden="true" tabindex="-1"></a>  pop_proportions <span class="ot">&lt;-</span> populations <span class="sc">/</span> total_pop</span>
<span id="cb139-722"><a href="#cb139-722" aria-hidden="true" tabindex="-1"></a>  sim_morans <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sims)</span>
<span id="cb139-723"><a href="#cb139-723" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-724"><a href="#cb139-724" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb139-725"><a href="#cb139-725" aria-hidden="true" tabindex="-1"></a>    sim_crimes <span class="ot">&lt;-</span> <span class="fu">rmultinom</span>(<span class="dv">1</span>, <span class="at">size =</span> total_crimes, <span class="at">prob =</span> pop_proportions)[,<span class="dv">1</span>]</span>
<span id="cb139-726"><a href="#cb139-726" aria-hidden="true" tabindex="-1"></a>    sim_rate <span class="ot">&lt;-</span> (sim_crimes <span class="sc">/</span> populations) <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb139-727"><a href="#cb139-727" aria-hidden="true" tabindex="-1"></a>    sim_rate[<span class="fu">is.infinite</span>(sim_rate)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb139-728"><a href="#cb139-728" aria-hidden="true" tabindex="-1"></a>    sim_moran <span class="ot">&lt;-</span> <span class="fu">moran</span>(sim_rate, weights, <span class="at">n =</span> <span class="fu">length</span>(sim_rate), <span class="at">S0 =</span> <span class="fu">Szero</span>(weights))</span>
<span id="cb139-729"><a href="#cb139-729" aria-hidden="true" tabindex="-1"></a>    sim_morans[i] <span class="ot">&lt;-</span> sim_moran<span class="sc">$</span>I</span>
<span id="cb139-730"><a href="#cb139-730" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb139-731"><a href="#cb139-731" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb139-732"><a href="#cb139-732" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Completed"</span>, i, <span class="st">"of"</span>, n_sims, <span class="st">"simulations</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb139-733"><a href="#cb139-733" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb139-734"><a href="#cb139-734" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb139-735"><a href="#cb139-735" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-736"><a href="#cb139-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sim_morans)</span>
<span id="cb139-737"><a href="#cb139-737" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-738"><a href="#cb139-738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-739"><a href="#cb139-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-740"><a href="#cb139-740" aria-hidden="true" tabindex="-1"></a>We run 999 Monte Carlo simulations for the before period and compare the observed Moran's I to the null distribution. If the observed value falls in the extreme tail of the null distribution (p &lt; 0.05), we conclude that crime is more clustered than expected under population-proportional allocation alone.</span>
<span id="cb139-741"><a href="#cb139-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-744"><a href="#cb139-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-745"><a href="#cb139-745" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: monte-carlo-before</span></span>
<span id="cb139-746"><a href="#cb139-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-747"><a href="#cb139-747" aria-hidden="true" tabindex="-1"></a>observed_moran_before <span class="ot">&lt;-</span> <span class="fu">moran</span>(</span>
<span id="cb139-748"><a href="#cb139-748" aria-hidden="true" tabindex="-1"></a>  precincts_before<span class="sc">$</span>crime_rate, </span>
<span id="cb139-749"><a href="#cb139-749" aria-hidden="true" tabindex="-1"></a>  weights_before, </span>
<span id="cb139-750"><a href="#cb139-750" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">nrow</span>(precincts_before), </span>
<span id="cb139-751"><a href="#cb139-751" aria-hidden="true" tabindex="-1"></a>  <span class="at">S0 =</span> <span class="fu">Szero</span>(weights_before)</span>
<span id="cb139-752"><a href="#cb139-752" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>I</span>
<span id="cb139-753"><a href="#cb139-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-754"><a href="#cb139-754" aria-hidden="true" tabindex="-1"></a>sim_morans_before <span class="ot">&lt;-</span> <span class="fu">simulate_morans_i</span>(precincts_before, weights_before, <span class="at">n_sims =</span> <span class="dv">999</span>)</span>
<span id="cb139-755"><a href="#cb139-755" aria-hidden="true" tabindex="-1"></a>p_value_before <span class="ot">&lt;-</span> (<span class="fu">sum</span>(sim_morans_before <span class="sc">&gt;=</span> observed_moran_before) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> (<span class="dv">999</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb139-756"><a href="#cb139-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-757"><a href="#cb139-757" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Mean simulated Moran's I:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(sim_morans_before), <span class="dv">4</span>))</span>
<span id="cb139-758"><a href="#cb139-758" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  SD simulated Moran's I:"</span>, <span class="fu">round</span>(<span class="fu">sd</span>(sim_morans_before), <span class="dv">4</span>))</span>
<span id="cb139-759"><a href="#cb139-759" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Observed Moran's I:"</span>, <span class="fu">round</span>(observed_moran_before, <span class="dv">4</span>))</span>
<span id="cb139-760"><a href="#cb139-760" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Monte Carlo p-value:"</span>, <span class="fu">round</span>(p_value_before, <span class="dv">4</span>))</span>
<span id="cb139-761"><a href="#cb139-761" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-762"><a href="#cb139-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-763"><a href="#cb139-763" aria-hidden="true" tabindex="-1"></a>We repeat the Monte Carlo simulation for the after period to assess whether "excess" clustering (beyond what population distribution would predict) changed after Patternizr implementation.</span>
<span id="cb139-764"><a href="#cb139-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-767"><a href="#cb139-767" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-768"><a href="#cb139-768" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: monte-carlo-after</span></span>
<span id="cb139-769"><a href="#cb139-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-770"><a href="#cb139-770" aria-hidden="true" tabindex="-1"></a>observed_moran_after <span class="ot">&lt;-</span> <span class="fu">moran</span>(</span>
<span id="cb139-771"><a href="#cb139-771" aria-hidden="true" tabindex="-1"></a>  precincts_after<span class="sc">$</span>crime_rate, </span>
<span id="cb139-772"><a href="#cb139-772" aria-hidden="true" tabindex="-1"></a>  weights_after, </span>
<span id="cb139-773"><a href="#cb139-773" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">nrow</span>(precincts_after), </span>
<span id="cb139-774"><a href="#cb139-774" aria-hidden="true" tabindex="-1"></a>  <span class="at">S0 =</span> <span class="fu">Szero</span>(weights_after)</span>
<span id="cb139-775"><a href="#cb139-775" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>I</span>
<span id="cb139-776"><a href="#cb139-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-777"><a href="#cb139-777" aria-hidden="true" tabindex="-1"></a>sim_morans_after <span class="ot">&lt;-</span> <span class="fu">simulate_morans_i</span>(precincts_after, weights_after, <span class="at">n_sims =</span> <span class="dv">999</span>)</span>
<span id="cb139-778"><a href="#cb139-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-779"><a href="#cb139-779" aria-hidden="true" tabindex="-1"></a>p_value_after <span class="ot">&lt;-</span> (<span class="fu">sum</span>(sim_morans_after <span class="sc">&gt;=</span> observed_moran_after) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> (<span class="dv">999</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb139-780"><a href="#cb139-780" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Mean simulated Moran's I:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(sim_morans_after), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb139-781"><a href="#cb139-781" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  SD simulated Moran's I:"</span>, <span class="fu">round</span>(<span class="fu">sd</span>(sim_morans_after), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb139-782"><a href="#cb139-782" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Observed Moran's I:"</span>, <span class="fu">round</span>(observed_moran_after, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb139-783"><a href="#cb139-783" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Monte Carlo p-value:"</span>, <span class="fu">round</span>(p_value_after, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb139-784"><a href="#cb139-784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-785"><a href="#cb139-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-786"><a href="#cb139-786" aria-hidden="true" tabindex="-1"></a>We visualize the Monte Carlo results by plotting histograms of the simulated Moran's I distributions with the observed values marked as vertical lines. This makes it easy to see whether the observed clustering is extreme relative to the null.</span>
<span id="cb139-787"><a href="#cb139-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-790"><a href="#cb139-790" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-791"><a href="#cb139-791" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: monte-carlo-plot</span></span>
<span id="cb139-792"><a href="#cb139-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-793"><a href="#cb139-793" aria-hidden="true" tabindex="-1"></a>sim_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb139-794"><a href="#cb139-794" aria-hidden="true" tabindex="-1"></a>  <span class="at">Morans_I =</span> <span class="fu">c</span>(sim_morans_before, sim_morans_after),</span>
<span id="cb139-795"><a href="#cb139-795" aria-hidden="true" tabindex="-1"></a>  <span class="at">Period =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Before (2010-2012)"</span>, <span class="st">"After (2013-2019)"</span>), <span class="at">each =</span> <span class="dv">999</span>)</span>
<span id="cb139-796"><a href="#cb139-796" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-797"><a href="#cb139-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-798"><a href="#cb139-798" aria-hidden="true" tabindex="-1"></a>observed_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb139-799"><a href="#cb139-799" aria-hidden="true" tabindex="-1"></a>  <span class="at">Morans_I =</span> <span class="fu">c</span>(observed_moran_before, observed_moran_after),</span>
<span id="cb139-800"><a href="#cb139-800" aria-hidden="true" tabindex="-1"></a>  <span class="at">Period =</span> <span class="fu">c</span>(<span class="st">"Before (2010-2012)"</span>, <span class="st">"After (2013-2019)"</span>)</span>
<span id="cb139-801"><a href="#cb139-801" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-802"><a href="#cb139-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-803"><a href="#cb139-803" aria-hidden="true" tabindex="-1"></a>monte_carlo_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sim_df, <span class="fu">aes</span>(<span class="at">x =</span> Morans_I)) <span class="sc">+</span></span>
<span id="cb139-804"><a href="#cb139-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb139-805"><a href="#cb139-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> observed_df, <span class="fu">aes</span>(<span class="at">xintercept =</span> Morans_I), </span>
<span id="cb139-806"><a href="#cb139-806" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb139-807"><a href="#cb139-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Period, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb139-808"><a href="#cb139-808" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb139-809"><a href="#cb139-809" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb139-810"><a href="#cb139-810" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monte Carlo Simulation: Crime Rate Spatial Autocorrelation"</span>,</span>
<span id="cb139-811"><a href="#cb139-811" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Null hypothesis: Crime distributed proportionally to population"</span>,</span>
<span id="cb139-812"><a href="#cb139-812" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Moran's I"</span>,</span>
<span id="cb139-813"><a href="#cb139-813" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frequency"</span>,</span>
<span id="cb139-814"><a href="#cb139-814" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Red dashed line = Observed Moran's I"</span></span>
<span id="cb139-815"><a href="#cb139-815" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb139-816"><a href="#cb139-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb139-817"><a href="#cb139-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-818"><a href="#cb139-818" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(monte_carlo_plot)</span>
<span id="cb139-819"><a href="#cb139-819" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-820"><a href="#cb139-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-821"><a href="#cb139-821" aria-hidden="true" tabindex="-1"></a>We compile the Monte Carlo results into a summary table and provide interpretations of what the p-values mean for our research questions.</span>
<span id="cb139-822"><a href="#cb139-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-825"><a href="#cb139-825" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-826"><a href="#cb139-826" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: monte-carlo-summary</span></span>
<span id="cb139-827"><a href="#cb139-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-828"><a href="#cb139-828" aria-hidden="true" tabindex="-1"></a>mc_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb139-829"><a href="#cb139-829" aria-hidden="true" tabindex="-1"></a>  <span class="at">Period =</span> <span class="fu">c</span>(<span class="st">"Before (2010-2012)"</span>, <span class="st">"After (2013-2019)"</span>),</span>
<span id="cb139-830"><a href="#cb139-830" aria-hidden="true" tabindex="-1"></a>  <span class="at">Observed_Morans_I =</span> <span class="fu">c</span>(observed_moran_before, observed_moran_after),</span>
<span id="cb139-831"><a href="#cb139-831" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_Simulated =</span> <span class="fu">c</span>(<span class="fu">mean</span>(sim_morans_before), <span class="fu">mean</span>(sim_morans_after)),</span>
<span id="cb139-832"><a href="#cb139-832" aria-hidden="true" tabindex="-1"></a>  <span class="at">SD_Simulated =</span> <span class="fu">c</span>(<span class="fu">sd</span>(sim_morans_before), <span class="fu">sd</span>(sim_morans_after)),</span>
<span id="cb139-833"><a href="#cb139-833" aria-hidden="true" tabindex="-1"></a>  <span class="at">P_Value =</span> <span class="fu">c</span>(p_value_before, p_value_after)</span>
<span id="cb139-834"><a href="#cb139-834" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-835"><a href="#cb139-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-836"><a href="#cb139-836" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mc_summary)</span>
<span id="cb139-837"><a href="#cb139-837" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-838"><a href="#cb139-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-839"><a href="#cb139-839" aria-hidden="true" tabindex="-1"></a><span class="fu">### Geographically Weighted Regression</span></span>
<span id="cb139-840"><a href="#cb139-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-841"><a href="#cb139-841" aria-hidden="true" tabindex="-1"></a>Finally, we fit geographically weighted regression (GWR) models in each period to assess spatial non-stationarity in the association between racial composition and crime rates. For precinct $p$ with coordinates $(u_p, v_p)$, GWR estimates location-specific coefficients:</span>
<span id="cb139-842"><a href="#cb139-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-843"><a href="#cb139-843" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-844"><a href="#cb139-844" aria-hidden="true" tabindex="-1"></a>CrimeRate_p = \beta_0(u_p,v_p) + \beta_1(u_p,v_p)\%Black_p + \beta_2(u_p,v_p)\%Hispanic_p + \beta_3(u_p,v_p)\%White_p + \varepsilon_p</span>
<span id="cb139-845"><a href="#cb139-845" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb139-846"><a href="#cb139-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-847"><a href="#cb139-847" aria-hidden="true" tabindex="-1"></a>An adaptive bandwidth is selected via the standard GWR bandwidth selection routine, and local coefficients (particularly $\beta_1(u_p,v_p)$) are mapped for visual comparison across periods. This component is explicitly diagnostic: changes in coefficient heterogeneity can reflect shifts in policing geography, demographic change, or other local dynamics; thus, results are interpreted as evidence of spatial variation rather than causal impact.</span>
<span id="cb139-848"><a href="#cb139-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-849"><a href="#cb139-849" aria-hidden="true" tabindex="-1"></a>We load the <span class="in">`spgwr`</span> package and prepare our data for GWR analysis. GWR requires point coordinates (we use precinct centroids) and fits a separate regression at each location, weighting nearby observations more heavily. We use adaptive bandwidth selection, which chooses the bandwidth that minimizes cross-validation error.</span>
<span id="cb139-850"><a href="#cb139-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-853"><a href="#cb139-853" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-854"><a href="#cb139-854" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gwr-analysis</span></span>
<span id="cb139-855"><a href="#cb139-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-856"><a href="#cb139-856" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spgwr)</span>
<span id="cb139-857"><a href="#cb139-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-858"><a href="#cb139-858" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for GWR - BEFORE period</span></span>
<span id="cb139-859"><a href="#cb139-859" aria-hidden="true" tabindex="-1"></a>precincts_gwr_before <span class="ot">&lt;-</span> precincts_before <span class="sc">%&gt;%</span></span>
<span id="cb139-860"><a href="#cb139-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(crime_rate), <span class="sc">!</span><span class="fu">is.na</span>(pct_black), <span class="sc">!</span><span class="fu">is.na</span>(pct_hispanic), <span class="sc">!</span><span class="fu">is.na</span>(pct_white))</span>
<span id="cb139-861"><a href="#cb139-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-862"><a href="#cb139-862" aria-hidden="true" tabindex="-1"></a>coords_before <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(precincts_gwr_before))</span>
<span id="cb139-863"><a href="#cb139-863" aria-hidden="true" tabindex="-1"></a>precincts_sp_before <span class="ot">&lt;-</span> <span class="fu">as</span>(precincts_gwr_before, <span class="st">"Spatial"</span>)</span>
<span id="cb139-864"><a href="#cb139-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-865"><a href="#cb139-865" aria-hidden="true" tabindex="-1"></a>bw_before <span class="ot">&lt;-</span> <span class="fu">gwr.sel</span>(</span>
<span id="cb139-866"><a href="#cb139-866" aria-hidden="true" tabindex="-1"></a>  crime_rate <span class="sc">~</span> pct_black <span class="sc">+</span> pct_hispanic <span class="sc">+</span> pct_white,</span>
<span id="cb139-867"><a href="#cb139-867" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> precincts_sp_before,</span>
<span id="cb139-868"><a href="#cb139-868" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> coords_before,</span>
<span id="cb139-869"><a href="#cb139-869" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt =</span> <span class="cn">TRUE</span></span>
<span id="cb139-870"><a href="#cb139-870" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-871"><a href="#cb139-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-872"><a href="#cb139-872" aria-hidden="true" tabindex="-1"></a>gwr_before <span class="ot">&lt;-</span> <span class="fu">gwr</span>(</span>
<span id="cb139-873"><a href="#cb139-873" aria-hidden="true" tabindex="-1"></a>  crime_rate <span class="sc">~</span> pct_black <span class="sc">+</span> pct_hispanic <span class="sc">+</span> pct_white,</span>
<span id="cb139-874"><a href="#cb139-874" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> precincts_sp_before,</span>
<span id="cb139-875"><a href="#cb139-875" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> coords_before,</span>
<span id="cb139-876"><a href="#cb139-876" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt =</span> bw_before,</span>
<span id="cb139-877"><a href="#cb139-877" aria-hidden="true" tabindex="-1"></a>  <span class="at">hatmatrix =</span> <span class="cn">TRUE</span></span>
<span id="cb139-878"><a href="#cb139-878" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-879"><a href="#cb139-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-880"><a href="#cb139-880" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gwr_before)</span>
<span id="cb139-881"><a href="#cb139-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-882"><a href="#cb139-882" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for GWR - AFTER period</span></span>
<span id="cb139-883"><a href="#cb139-883" aria-hidden="true" tabindex="-1"></a>precincts_gwr_after <span class="ot">&lt;-</span> precincts_after <span class="sc">%&gt;%</span></span>
<span id="cb139-884"><a href="#cb139-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(crime_rate), <span class="sc">!</span><span class="fu">is.na</span>(pct_black), <span class="sc">!</span><span class="fu">is.na</span>(pct_hispanic), <span class="sc">!</span><span class="fu">is.na</span>(pct_white))</span>
<span id="cb139-885"><a href="#cb139-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-886"><a href="#cb139-886" aria-hidden="true" tabindex="-1"></a>coords_after <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(precincts_gwr_after))</span>
<span id="cb139-887"><a href="#cb139-887" aria-hidden="true" tabindex="-1"></a>precincts_sp_after <span class="ot">&lt;-</span> <span class="fu">as</span>(precincts_gwr_after, <span class="st">"Spatial"</span>)</span>
<span id="cb139-888"><a href="#cb139-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-889"><a href="#cb139-889" aria-hidden="true" tabindex="-1"></a>bw_after <span class="ot">&lt;-</span> <span class="fu">gwr.sel</span>(</span>
<span id="cb139-890"><a href="#cb139-890" aria-hidden="true" tabindex="-1"></a>  crime_rate <span class="sc">~</span> pct_black <span class="sc">+</span> pct_hispanic <span class="sc">+</span> pct_white,</span>
<span id="cb139-891"><a href="#cb139-891" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> precincts_sp_after,</span>
<span id="cb139-892"><a href="#cb139-892" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> coords_after,</span>
<span id="cb139-893"><a href="#cb139-893" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt =</span> <span class="cn">TRUE</span></span>
<span id="cb139-894"><a href="#cb139-894" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-895"><a href="#cb139-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-896"><a href="#cb139-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-897"><a href="#cb139-897" aria-hidden="true" tabindex="-1"></a>gwr_after <span class="ot">&lt;-</span> <span class="fu">gwr</span>(</span>
<span id="cb139-898"><a href="#cb139-898" aria-hidden="true" tabindex="-1"></a>  crime_rate <span class="sc">~</span> pct_black <span class="sc">+</span> pct_hispanic <span class="sc">+</span> pct_white,</span>
<span id="cb139-899"><a href="#cb139-899" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> precincts_sp_after,</span>
<span id="cb139-900"><a href="#cb139-900" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> coords_after,</span>
<span id="cb139-901"><a href="#cb139-901" aria-hidden="true" tabindex="-1"></a>  <span class="at">adapt =</span> bw_after,</span>
<span id="cb139-902"><a href="#cb139-902" aria-hidden="true" tabindex="-1"></a>  <span class="at">hatmatrix =</span> <span class="cn">TRUE</span></span>
<span id="cb139-903"><a href="#cb139-903" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-904"><a href="#cb139-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-905"><a href="#cb139-905" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gwr_after)</span>
<span id="cb139-906"><a href="#cb139-906" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-907"><a href="#cb139-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-908"><a href="#cb139-908" aria-hidden="true" tabindex="-1"></a>We extract the local coefficients from the GWR model results. Each precinct has its own estimated coefficient for percent Black, which tells us the local relationship between racial composition and crime rates at that location.</span>
<span id="cb139-909"><a href="#cb139-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-912"><a href="#cb139-912" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-913"><a href="#cb139-913" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gwr-coefficients</span></span>
<span id="cb139-914"><a href="#cb139-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-915"><a href="#cb139-915" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficients from GWR results</span></span>
<span id="cb139-916"><a href="#cb139-916" aria-hidden="true" tabindex="-1"></a>gwr_coefs_before <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(gwr_before<span class="sc">$</span>SDF)</span>
<span id="cb139-917"><a href="#cb139-917" aria-hidden="true" tabindex="-1"></a>gwr_coefs_after <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(gwr_after<span class="sc">$</span>SDF)</span>
<span id="cb139-918"><a href="#cb139-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-919"><a href="#cb139-919" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to sf objects</span></span>
<span id="cb139-920"><a href="#cb139-920" aria-hidden="true" tabindex="-1"></a>precincts_gwr_before<span class="sc">$</span>gwr_pct_black <span class="ot">&lt;-</span> gwr_coefs_before<span class="sc">$</span>pct_black</span>
<span id="cb139-921"><a href="#cb139-921" aria-hidden="true" tabindex="-1"></a>precincts_gwr_before<span class="sc">$</span>gwr_intercept <span class="ot">&lt;-</span> gwr_coefs_before<span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span></span>
<span id="cb139-922"><a href="#cb139-922" aria-hidden="true" tabindex="-1"></a>precincts_gwr_before<span class="sc">$</span>gwr_localR2 <span class="ot">&lt;-</span> gwr_coefs_before<span class="sc">$</span>localR2</span>
<span id="cb139-923"><a href="#cb139-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-924"><a href="#cb139-924" aria-hidden="true" tabindex="-1"></a>precincts_gwr_after<span class="sc">$</span>gwr_pct_black <span class="ot">&lt;-</span> gwr_coefs_after<span class="sc">$</span>pct_black</span>
<span id="cb139-925"><a href="#cb139-925" aria-hidden="true" tabindex="-1"></a>precincts_gwr_after<span class="sc">$</span>gwr_intercept <span class="ot">&lt;-</span> gwr_coefs_after<span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span></span>
<span id="cb139-926"><a href="#cb139-926" aria-hidden="true" tabindex="-1"></a>precincts_gwr_after<span class="sc">$</span>gwr_localR2 <span class="ot">&lt;-</span> gwr_coefs_after<span class="sc">$</span>localR2</span>
<span id="cb139-927"><a href="#cb139-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-928"><a href="#cb139-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-929"><a href="#cb139-929" aria-hidden="true" tabindex="-1"></a>We create maps showing the local percent Black coefficient across NYC precincts for both periods. Red indicates a stronger positive relationship between percent Black and crime rate at that location; blue indicates a weaker or negative relationship. Comparing these maps reveals whether the race-crime relationship became more spatially heterogeneous after Patternizr.</span>
<span id="cb139-930"><a href="#cb139-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-933"><a href="#cb139-933" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-934"><a href="#cb139-934" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gwr-maps</span></span>
<span id="cb139-935"><a href="#cb139-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-936"><a href="#cb139-936" aria-hidden="true" tabindex="-1"></a><span class="co"># Get consistent color scale</span></span>
<span id="cb139-937"><a href="#cb139-937" aria-hidden="true" tabindex="-1"></a>coef_range <span class="ot">&lt;-</span> <span class="fu">range</span>(<span class="fu">c</span>(precincts_gwr_before<span class="sc">$</span>gwr_pct_black, precincts_gwr_after<span class="sc">$</span>gwr_pct_black))</span>
<span id="cb139-938"><a href="#cb139-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-939"><a href="#cb139-939" aria-hidden="true" tabindex="-1"></a>gwr_map_before <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(precincts_gwr_before) <span class="sc">+</span></span>
<span id="cb139-940"><a href="#cb139-940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gwr_pct_black), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb139-941"><a href="#cb139-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb139-942"><a href="#cb139-942" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"#377EB8"</span>,</span>
<span id="cb139-943"><a href="#cb139-943" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb139-944"><a href="#cb139-944" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"#E41A1C"</span>,</span>
<span id="cb139-945"><a href="#cb139-945" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb139-946"><a href="#cb139-946" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Local</span><span class="sc">\n</span><span class="st">Coefficient"</span>,</span>
<span id="cb139-947"><a href="#cb139-947" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> coef_range</span>
<span id="cb139-948"><a href="#cb139-948" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb139-949"><a href="#cb139-949" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb139-950"><a href="#cb139-950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"BEFORE (2010-2012)"</span>) <span class="sc">+</span></span>
<span id="cb139-951"><a href="#cb139-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb139-952"><a href="#cb139-952" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb139-953"><a href="#cb139-953" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb139-954"><a href="#cb139-954" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb139-955"><a href="#cb139-955" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-956"><a href="#cb139-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-957"><a href="#cb139-957" aria-hidden="true" tabindex="-1"></a>gwr_map_after <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(precincts_gwr_after) <span class="sc">+</span></span>
<span id="cb139-958"><a href="#cb139-958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gwr_pct_black), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb139-959"><a href="#cb139-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb139-960"><a href="#cb139-960" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"#377EB8"</span>,</span>
<span id="cb139-961"><a href="#cb139-961" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb139-962"><a href="#cb139-962" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"#E41A1C"</span>,</span>
<span id="cb139-963"><a href="#cb139-963" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb139-964"><a href="#cb139-964" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Local</span><span class="sc">\n</span><span class="st">Coefficient"</span>,</span>
<span id="cb139-965"><a href="#cb139-965" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> coef_range</span>
<span id="cb139-966"><a href="#cb139-966" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb139-967"><a href="#cb139-967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb139-968"><a href="#cb139-968" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AFTER (2013-2019)"</span>) <span class="sc">+</span></span>
<span id="cb139-969"><a href="#cb139-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb139-970"><a href="#cb139-970" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb139-971"><a href="#cb139-971" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb139-972"><a href="#cb139-972" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb139-973"><a href="#cb139-973" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-974"><a href="#cb139-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-975"><a href="#cb139-975" aria-hidden="true" tabindex="-1"></a>gwr_comparison <span class="ot">&lt;-</span> gwr_map_before <span class="sc">+</span> gwr_map_after <span class="sc">+</span></span>
<span id="cb139-976"><a href="#cb139-976" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb139-977"><a href="#cb139-977" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GWR: Local Effect of % Black on Crime Rate"</span>,</span>
<span id="cb139-978"><a href="#cb139-978" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Red = stronger positive relationship; Blue = weaker/negative relationship"</span></span>
<span id="cb139-979"><a href="#cb139-979" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-980"><a href="#cb139-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-981"><a href="#cb139-981" aria-hidden="true" tabindex="-1"></a><span class="co"># print(gwr_comparison)</span></span>
<span id="cb139-982"><a href="#cb139-982" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-983"><a href="#cb139-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-984"><a href="#cb139-984" aria-hidden="true" tabindex="-1"></a>We also map the local R² values from GWR, which show how well the demographic model explains crime rate variation at each location. Higher values indicate that demographics are more predictive of crime in that area.</span>
<span id="cb139-985"><a href="#cb139-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-988"><a href="#cb139-988" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-989"><a href="#cb139-989" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gwr-r2-maps</span></span>
<span id="cb139-990"><a href="#cb139-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-991"><a href="#cb139-991" aria-hidden="true" tabindex="-1"></a>r2_range <span class="ot">&lt;-</span> <span class="fu">range</span>(<span class="fu">c</span>(precincts_gwr_before<span class="sc">$</span>gwr_localR2, precincts_gwr_after<span class="sc">$</span>gwr_localR2))</span>
<span id="cb139-992"><a href="#cb139-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-993"><a href="#cb139-993" aria-hidden="true" tabindex="-1"></a>r2_map_before <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(precincts_gwr_before) <span class="sc">+</span></span>
<span id="cb139-994"><a href="#cb139-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gwr_localR2), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb139-995"><a href="#cb139-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">name =</span> <span class="st">"Local R²"</span>, <span class="at">limits =</span> r2_range) <span class="sc">+</span></span>
<span id="cb139-996"><a href="#cb139-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb139-997"><a href="#cb139-997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"BEFORE (2010-2012)"</span>) <span class="sc">+</span></span>
<span id="cb139-998"><a href="#cb139-998" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb139-999"><a href="#cb139-999" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb139-1000"><a href="#cb139-1000" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb139-1001"><a href="#cb139-1001" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb139-1002"><a href="#cb139-1002" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-1003"><a href="#cb139-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1004"><a href="#cb139-1004" aria-hidden="true" tabindex="-1"></a>r2_map_after <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(precincts_gwr_after) <span class="sc">+</span></span>
<span id="cb139-1005"><a href="#cb139-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gwr_localR2), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb139-1006"><a href="#cb139-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">name =</span> <span class="st">"Local R²"</span>, <span class="at">limits =</span> r2_range) <span class="sc">+</span></span>
<span id="cb139-1007"><a href="#cb139-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb139-1008"><a href="#cb139-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AFTER (2013-2019)"</span>) <span class="sc">+</span></span>
<span id="cb139-1009"><a href="#cb139-1009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb139-1010"><a href="#cb139-1010" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb139-1011"><a href="#cb139-1011" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb139-1012"><a href="#cb139-1012" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb139-1013"><a href="#cb139-1013" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-1014"><a href="#cb139-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1015"><a href="#cb139-1015" aria-hidden="true" tabindex="-1"></a>r2_comparison <span class="ot">&lt;-</span> r2_map_before <span class="sc">+</span> r2_map_after <span class="sc">+</span></span>
<span id="cb139-1016"><a href="#cb139-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb139-1017"><a href="#cb139-1017" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GWR: Local Model Fit (R²)"</span>,</span>
<span id="cb139-1018"><a href="#cb139-1018" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Higher = demographics explain more crime variation in that area"</span></span>
<span id="cb139-1019"><a href="#cb139-1019" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-1020"><a href="#cb139-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1021"><a href="#cb139-1021" aria-hidden="true" tabindex="-1"></a><span class="co"># print(r2_comparison)</span></span>
<span id="cb139-1022"><a href="#cb139-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1023"><a href="#cb139-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1024"><a href="#cb139-1024" aria-hidden="true" tabindex="-1"></a>We summarize the distribution of local percent Black coefficients across precincts to quantify how much the race-crime relationship varies spatially and how this variation changed between periods.</span>
<span id="cb139-1025"><a href="#cb139-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1028"><a href="#cb139-1028" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1029"><a href="#cb139-1029" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gwr-summary</span></span>
<span id="cb139-1030"><a href="#cb139-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1031"><a href="#cb139-1031" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(precincts_gwr_before<span class="sc">$</span>gwr_pct_black))</span>
<span id="cb139-1032"><a href="#cb139-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1033"><a href="#cb139-1033" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(precincts_gwr_after<span class="sc">$</span>gwr_pct_black))</span>
<span id="cb139-1034"><a href="#cb139-1034" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1035"><a href="#cb139-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1036"><a href="#cb139-1036" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results</span></span>
<span id="cb139-1037"><a href="#cb139-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1038"><a href="#cb139-1038" aria-hidden="true" tabindex="-1"></a><span class="fu">### Global spatial autocorrelation</span></span>
<span id="cb139-1039"><a href="#cb139-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1040"><a href="#cb139-1040" aria-hidden="true" tabindex="-1"></a>Violent felony crime rates exhibit statistically meaningful positive spatial autocorrelation in both periods. Before Patternizr, the Global Moran's I for precinct crime rate was $I = 0.269$, indicating moderate spatial clustering. In the post-Patternizr period (2013–2019), this clustering strengthened to $I = 0.341$, suggesting that high- and low-crime precincts became more geographically concentrated over time.</span>
<span id="cb139-1041"><a href="#cb139-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1042"><a href="#cb139-1042" aria-hidden="true" tabindex="-1"></a>Racial composition is substantially more spatially clustered than crime in both periods. The Global Moran's I for percent Black population was $I = 0.570$ in 2010–2012 and remained comparably high in 2013–2019 ($I = 0.558$). This persistence is consistent with stable patterns of residential segregation at the precinct scale. Notably, while crime clustering increased across periods, the degree of racial clustering changed only marginally.</span>
<span id="cb139-1043"><a href="#cb139-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1044"><a href="#cb139-1044" aria-hidden="true" tabindex="-1"></a><span class="fu">### Local clustering and overlap of crime and race "hot spots"</span></span>
<span id="cb139-1045"><a href="#cb139-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1046"><a href="#cb139-1046" aria-hidden="true" tabindex="-1"></a>Local Indicators of Spatial Association (LISA) provide a complementary view of these patterns. The number of High–High crime clusters decreased from 6 precincts in 2010–2012 to 4 precincts in 2013–2019, indicating fewer statistically significant violent-crime hot spots in the later period. The number of High–High Black population clusters also declined slightly (from 7 to 6 precincts), again suggesting that the spatial concentration of Black population remained largely stable.</span>
<span id="cb139-1047"><a href="#cb139-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1048"><a href="#cb139-1048" aria-hidden="true" tabindex="-1"></a>The most consequential local result concerns the intersection of these cluster types. In the pre-Patternizr period, 3 precincts were simultaneously classified as High–High for crime rates and High–High for Black population share.</span>
<span id="cb139-1049"><a href="#cb139-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1050"><a href="#cb139-1050" aria-hidden="true" tabindex="-1"></a><span class="al">![LISA cluster classifications for violent felony crime rates by precinct before (2010–2012) vs after (2013–2019) Patternizr.](lisa_crime_comparison.png)</span></span>
<span id="cb139-1051"><a href="#cb139-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1052"><a href="#cb139-1052" aria-hidden="true" tabindex="-1"></a><span class="al">![LISA cluster classifications for percent Black population by precinct (2010 Census vs 2020 Census).](lisa_black_comparison.png)</span></span>
<span id="cb139-1053"><a href="#cb139-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1054"><a href="#cb139-1054" aria-hidden="true" tabindex="-1"></a>In the post-Patternizr period, this overlap fell to 0 precincts. Thus, while both crime and race remained spatially clustered in their own right, the geographic coincidence of Black-population hot spots with violent-crime hot spots disappeared in the post-implementation period.</span>
<span id="cb139-1055"><a href="#cb139-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1056"><a href="#cb139-1056" aria-hidden="true" tabindex="-1"></a><span class="fu">### Monte Carlo evidence of "excess" clustering beyond population distribution</span></span>
<span id="cb139-1057"><a href="#cb139-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1058"><a href="#cb139-1058" aria-hidden="true" tabindex="-1"></a>Monte Carlo simulations further indicate that the observed crime clustering is unlikely to be attributable to population distribution alone. Under a null model in which crimes are allocated proportionally to precinct population, the probability of observing crime-rate Moran's I values as large as those measured is small in both periods (pre: $p = 0.003$; post: $p = 0.001$). These results imply that violent crime is significantly more spatially clustered than expected under population-proportional allocation, and that this "excess" clustering is at least as pronounced—if not more pronounced—in the post-Patternizr period.</span>
<span id="cb139-1059"><a href="#cb139-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1060"><a href="#cb139-1060" aria-hidden="true" tabindex="-1"></a><span class="al">![Monte Carlo null distributions of Moran's I for crime rates under a population-proportional allocation model.](monte_carlo_simulation.png)</span></span>
<span id="cb139-1061"><a href="#cb139-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1062"><a href="#cb139-1062" aria-hidden="true" tabindex="-1"></a><span class="fu">### Geographically Weighted Regression</span></span>
<span id="cb139-1063"><a href="#cb139-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1064"><a href="#cb139-1064" aria-hidden="true" tabindex="-1"></a>To assess spatial non-stationarity in the race–crime relationship, we fit geographically weighted regression (GWR) models in each period with precinct violent felony rate as the dependent variable and percent Black, percent Hispanic, and percent White as predictors. Across both periods, the GWR results indicate that the form of the demographic–crime relationship changes substantially after Patternizr, shifting from relatively smooth spatial variation to extreme localization and heterogeneity.</span>
<span id="cb139-1065"><a href="#cb139-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1066"><a href="#cb139-1066" aria-hidden="true" tabindex="-1"></a>In the pre-Patternizr period (2010–2012), the optimal adaptive bandwidth selected by cross-validation was $q \approx 0.382$, corresponding to approximately 29 of 76 precincts contributing to each local estimate. This relatively large bandwidth implies that local coefficients are estimated using broad neighborhood information, producing a comparatively smooth spatial surface.</span>
<span id="cb139-1067"><a href="#cb139-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1068"><a href="#cb139-1068" aria-hidden="true" tabindex="-1"></a><span class="al">![Geographically weighted regression (GWR) local coefficients for percent Black predicting violent felony crime rate.](gwr_pct_black_comparison.png)</span></span>
<span id="cb139-1069"><a href="#cb139-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1070"><a href="#cb139-1070" aria-hidden="true" tabindex="-1"></a>Consistent with this, the local %Black coefficient is uniformly positive and tightly distributed across precincts (min = 0.2328, median = 0.3176, max = 0.4034; mean = 0.3183). The quasi-global $R^2$ is 0.3585, indicating that allowing coefficients to vary spatially yields a moderate improvement in explanatory power relative to a purely global specification.</span>
<span id="cb139-1071"><a href="#cb139-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1072"><a href="#cb139-1072" aria-hidden="true" tabindex="-1"></a><span class="al">![GWR local R² surfaces for 2010–2012 vs 2013–2019.](gwr_localR2_comparison.png)</span></span>
<span id="cb139-1073"><a href="#cb139-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1074"><a href="#cb139-1074" aria-hidden="true" tabindex="-1"></a>In the post-Patternizr period (2013–2019), the optimal bandwidth shrinks dramatically to $q \approx 0.022$, corresponding to approximately 1 of 76 precincts contributing to each local estimate. This indicates an extremely localized specification and a strong departure from spatial stationarity. The distribution of local %Black coefficients expands sharply and changes qualitatively: coefficients range from negative to extremely large positive values (min = −3.7466, median = 1.2650, max = 18.1796; mean = 2.4041). The quasi-global $R^2$ rises to 0.9391, suggesting that the model—when permitted to vary at highly local scales—captures a very large share of precinct-level variation in crime rates.</span>
<span id="cb139-1075"><a href="#cb139-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1076"><a href="#cb139-1076" aria-hidden="true" tabindex="-1"></a>However, the post-period GWR fit must be interpreted cautiously. The effective number of parameters increases markedly (approximately 39.2 in the post-period versus 6.7 in the pre-period), reflecting substantially greater model flexibility. As a result, the dramatic increase in quasi-global $R^2$ is consistent with heightened spatial heterogeneity but may also reflect overfitting induced by the extremely small adaptive bandwidth.</span>
<span id="cb139-1077"><a href="#cb139-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1078"><a href="#cb139-1078" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpretation</span></span>
<span id="cb139-1079"><a href="#cb139-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1080"><a href="#cb139-1080" aria-hidden="true" tabindex="-1"></a>Synthesizing the global, local, and GWR results yields a coherent descriptive pattern. First, violent crime becomes more spatially clustered after Patternizr (Moran's I: 0.269 → 0.341), and this clustering is stronger than would be expected under a population-proportional null model in both periods (Monte Carlo $p = 0.003$ pre; $p = 0.001$ post). Second, racial composition remains highly clustered and changes little between periods ($I = 0.570$ pre; $I = 0.558$ post), indicating that segregation-like spatial structure persists regardless of policing regime. Third, despite these persistent forms of clustering, the spatial coincidence of Black-population hot spots and violent-crime hot spots disappears (overlap: 3 → 0 precincts).</span>
<span id="cb139-1081"><a href="#cb139-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1082"><a href="#cb139-1082" aria-hidden="true" tabindex="-1"></a>The GWR results provide a plausible statistical complement to this spatial decoupling: before Patternizr, the association between %Black and crime rate is consistently positive and spatially smooth, whereas after Patternizr the relationship becomes sharply non-stationary, varying widely in magnitude and even sign across precincts. In practical terms, this implies that the post-Patternizr period is less well described by a single citywide race–crime gradient and more consistent with localized, place-specific dynamics. Importantly, this change is observational and does not, by itself, identify a causal effect of Patternizr. The post-period encompasses substantial social and demographic change, and the extreme localization implied by the selected bandwidth suggests that any causal interpretation would require additional identification strategies and sensitivity analyses.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>  </div> <!-- /content -->  <script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script> 
  
</body></html>